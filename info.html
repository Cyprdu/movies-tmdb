<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chargement du film...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #141414; color: white; }
        /* Masquer la scrollbar tout en gardant le scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .backdrop-overlay {
            background: linear-gradient(to top, #141414 10%, transparent 90%),
                        linear-gradient(to right, #141414 0%, transparent 50%);
        }
        .shimmer {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #1f1f1f 4%, #2e2e2e 25%, #1f1f1f 36%);
            background-size: 1000px 100%;
        }
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="loader" class="fixed inset-0 flex items-center justify-center bg-[#141414] z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-red-600"></div>
    </div>

    <div id="content" class="hidden">
        
        <div class="relative w-full h-[85vh] lg:h-[95vh]">
            <div id="hero-bg" class="absolute inset-0 bg-cover bg-center bg-no-repeat transition-opacity duration-700"></div>
            <div class="absolute inset-0 backdrop-overlay pointer-events-none"></div>

            <div class="absolute bottom-0 left-0 w-full p-8 md:p-16 z-10 flex flex-col md:flex-row gap-8 items-end md:items-center">
                
                <div class="w-full md:w-2/3 lg:w-1/2 space-y-6">
                    <div id="movie-logo-container" class="mb-4">
                        <h1 id="movie-title" class="text-4xl md:text-6xl font-black leading-tight drop-shadow-lg"></h1>
                    </div>

                    <div class="flex items-center space-x-4 text-sm md:text-base text-gray-300 font-semibold">
                        <span id="release-year" class="text-green-400"></span>
                        <span id="runtime"></span>
                        <span id="vote-average" class="border border-gray-500 px-2 py-0.5 rounded"></span>
                    </div>

                    <p id="overview" class="text-gray-200 text-lg line-clamp-4 md:line-clamp-none max-w-2xl drop-shadow-md"></p>

                    <div class="flex space-x-4 pt-4">
                        <a id="play-btn" href="#" class="flex items-center bg-white text-black px-8 py-3 rounded hover:bg-opacity-80 transition font-bold text-lg">
                            <i class="fas fa-play mr-3"></i> Lecture
                        </a>
                        <button onclick="document.getElementById('trailer-section').scrollIntoView({behavior: 'smooth'})" class="flex items-center bg-gray-600 bg-opacity-70 text-white px-6 py-3 rounded hover:bg-opacity-50 transition font-semibold backdrop-blur-sm">
                            <i class="fas fa-info-circle mr-3"></i> Bande-annonce
                        </button>
                    </div>
                    
                    <div id="genres" class="text-sm text-gray-400 pt-2"></div>
                </div>

                <div class="hidden md:block w-1/3 lg:w-1/4">
                    <img id="poster-img" src="" alt="Affiche" class="rounded-lg shadow-2xl border border-gray-700 transform hover:scale-105 transition duration-300">
                </div>
            </div>
        </div>

        <div class="px-8 py-12 md:px-16 space-y-16 max-w-7xl mx-auto">
            
            <section>
                <h2 class="text-2xl font-bold mb-6 border-l-4 border-red-600 pl-4">Casting Principal</h2>
                <div id="cast-list" class="flex overflow-x-auto space-x-6 pb-6 no-scrollbar snap-x">
                    </div>
            </section>

            <section id="trailer-section">
                <h2 class="text-2xl font-bold mb-6 border-l-4 border-red-600 pl-4">Bandes-annonces</h2>
                <div id="trailer-container" class="aspect-video w-full bg-black rounded-xl overflow-hidden shadow-lg">
                    <div class="flex h-full items-center justify-center text-gray-500">Aucune vidéo disponible</div>
                </div>
            </section>

        </div>

        <footer class="text-center text-gray-500 py-10 text-sm">
            <p>Données fournies par <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_short-8e7b30f73a4020692ccca9c88bafe5dcb6f8a62a4c6bc55cd9ba82bb2cd95f6c.svg" alt="TMDB" class="inline h-4 ml-1"></p>
        </footer>
    </div>

    <script>
        // ---------------- CONFIGURATION ----------------
        // REMPLACEZ 'VOTRE_TOKEN' PAR LE TOKEN QUE VOUS M'AVEZ DONNÉ
        // (Pour la sécurité, je le mets en variable, copiez-collez le vôtre ici)
        const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';
        
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/original'; // Haute qualité pour le fond
        const POSTER_SIZE = 'https://image.tmdb.org/t/p/w500';
        const PROFILE_SIZE = 'https://image.tmdb.org/t/p/w185';

        // ---------------- LOGIQUE ----------------

        async function init() {
            // 1. Récupérer l'ID depuis l'URL (ex: ?1084736)
            const queryString = window.location.search;
            const movieId = queryString ? queryString.substring(1) : null;

            if (!movieId || isNaN(movieId)) {
                alert("Aucun ID de film valide trouvé dans l'URL.");
                document.getElementById('loader').style.display = 'none';
                return;
            }

            // 2. Préparer les headers
            const options = {
                method: 'GET',
                headers: {
                    accept: 'application/json',
                    Authorization: `Bearer ${TMDB_TOKEN}`
                }
            };

            try {
                // 3. Appels API en parallèle (Details, Crédits, Vidéos, Images pour le logo)
                const [detailsRes, creditsRes, videosRes, imagesRes] = await Promise.all([
                    fetch(`${BASE_URL}/movie/${movieId}?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/credits?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/videos?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/images`, options) // Pas de langue pour avoir tous les logos
                ]);

                if (!detailsRes.ok) throw new Error("Erreur lors de la récupération du film");

                const movie = await detailsRes.json();
                const credits = await creditsRes.json();
                const videos = await videosRes.json();
                const images = await imagesRes.json();

                // 4. Remplir l'interface
                populateUI(movie, credits, videos, images);

            } catch (err) {
                console.error(err);
                alert("Impossible de charger les infos du film. Vérifiez la console.");
            } finally {
                // Masquer le loader
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                document.getElementById('content').classList.add('animate-fade-in');
            }
        }

        function populateUI(movie, credits, videos, images) {
            // -- Meta Basiques --
            document.title = movie.title;
            document.getElementById('movie-title').textContent = movie.title;
            document.getElementById('overview').textContent = movie.overview || "Aucune description disponible.";
            document.getElementById('release-year').textContent = movie.release_date ? movie.release_date.split('-')[0] : 'N/A';
            
            // Formatage durée (ex: 2h 14m)
            const hours = Math.floor(movie.runtime / 60);
            const minutes = movie.runtime % 60;
            document.getElementById('runtime').textContent = `${hours}h ${minutes}m`;
            
            document.getElementById('vote-average').textContent = `Note: ${movie.vote_average.toFixed(1)}`;
            document.getElementById('genres').textContent = "Genres : " + movie.genres.map(g => g.name).join(', ');

            // -- Images (Backdrop & Poster) --
            if (movie.backdrop_path) {
                document.getElementById('hero-bg').style.backgroundImage = `url('${IMAGE_BASE_URL}${movie.backdrop_path}')`;
            }
            if (movie.poster_path) {
                document.getElementById('poster-img').src = `${POSTER_SIZE}${movie.poster_path}`;
            } else {
                document.getElementById('poster-img').style.display = 'none';
            }

            // -- Logo (Cherche un logo PNG, sinon garde le titre texte) --
            // On cherche un logo en français, sinon en anglais
            const logos = images.logos.filter(l => l.iso_639_1 === 'fr' || l.iso_639_1 === 'en');
            if (logos.length > 0) {
                // Prendre le premier logo (souvent le mieux noté)
                const logoPath = logos[0].file_path;
                const logoUrl = `${IMAGE_BASE_URL}${logoPath}`;
                
                const logoImg = document.createElement('img');
                logoImg.src = logoUrl;
                logoImg.alt = movie.title;
                logoImg.className = "h-24 md:h-32 object-contain mb-4 origin-left"; // Tailwind classes
                
                const titleContainer = document.getElementById('movie-logo-container');
                titleContainer.innerHTML = ''; // Enlever le texte h1
                titleContainer.appendChild(logoImg);
            }

            // -- Bouton Play --
            const playBtn = document.getElementById('play-btn');
            playBtn.href = `${movie.id}.html`; // Lien vers 1084736.html

            // -- Casting (Top 10) --
            const castContainer = document.getElementById('cast-list');
            const topCast = credits.cast.slice(0, 10);
            
            if(topCast.length === 0) {
                 castContainer.innerHTML = '<p class="text-gray-500">Aucune info casting.</p>';
            } else {
                topCast.forEach(actor => {
                    if (actor.profile_path) {
                        const actorDiv = document.createElement('div');
                        actorDiv.className = "flex-none w-32 text-center snap-start";
                        actorDiv.innerHTML = `
                            <div class="w-24 h-24 mx-auto mb-2 rounded-full overflow-hidden border-2 border-gray-700">
                                <img src="${PROFILE_SIZE}${actor.profile_path}" alt="${actor.name}" class="w-full h-full object-cover">
                            </div>
                            <h3 class="text-sm font-bold text-white truncate">${actor.name}</h3>
                            <p class="text-xs text-gray-400 truncate">${actor.character}</p>
                        `;
                        castContainer.appendChild(actorDiv);
                    }
                });
            }

            // -- Trailer (YouTube) --
            // Chercher Trailer officiel sur YouTube
            let trailer = videos.results.find(v => v.site === 'YouTube' && v.type === 'Trailer');
            // Si pas de trailer FR, chercher n'importe quel trailer YouTube
            if (!trailer) {
                // Fallback: Essayer de récupérer en anglais si besoin (nécessiterait un autre appel API, 
                // ici on filtre juste ce qu'on a reçu. Souvent l'API renvoie des résultats mixtes).
                 trailer = videos.results.find(v => v.site === 'YouTube');
            }

            const trailerContainer = document.getElementById('trailer-container');
            if (trailer) {
                trailerContainer.innerHTML = `
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/${trailer.key}?rel=0&showinfo=0&autoplay=0" 
                        title="Bande annonce" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                `;
            }
        }

        // Lancer le script au chargement
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
