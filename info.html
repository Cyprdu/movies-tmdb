<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info Film</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #141414; color: white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Dégradé plus fort pour lisibilité texte */
        .backdrop-overlay {
            background: linear-gradient(to right, #141414 20%, rgba(20,20,20,0.8) 50%, rgba(20,20,20,0.4) 100%),
                        linear-gradient(to top, #141414 0%, transparent 50%);
        }
    </style>
</head>
<body class="min-h-screen bg-[#141414]">

    <div id="loader" class="fixed inset-0 flex items-center justify-center bg-[#141414] z-[100]">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"></div>
    </div>

    <a href="index.html" class="fixed top-6 left-6 z-50 flex items-center gap-2 bg-black/50 hover:bg-white/20 backdrop-blur-md px-4 py-2 rounded-full transition text-white text-sm font-semibold border border-white/10 group">
        <i class="fas fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Retour
    </a>

    <div id="content" class="hidden relative">
        
        <div class="relative min-h-screen lg:min-h-[85vh] flex items-center">
            
            <div id="hero-bg" class="absolute inset-0 bg-cover bg-center transition-opacity duration-700 opacity-60"></div>
            <div class="absolute inset-0 backdrop-overlay pointer-events-none"></div>

            <div class="container mx-auto px-6 relative z-10 pt-20 pb-10">
                <div class="flex flex-col md:flex-row items-center md:items-start gap-10 lg:gap-16">
                    
                    <div class="hidden md:block w-64 lg:w-80 shrink-0">
                        <img id="poster-img" src="" alt="Affiche" class="w-full rounded-lg shadow-[0_0_20px_rgba(0,0,0,0.8)] border border-white/10 rotate-1 hover:rotate-0 transition duration-500 transform">
                    </div>

                    <div class="flex-1 space-y-6 text-center md:text-left">
                        
                        <div id="movie-logo-container" class="h-24 md:h-32 flex items-center justify-center md:justify-start">
                            <h1 id="movie-title" class="text-4xl md:text-6xl font-black leading-tight"></h1>
                        </div>

                        <div class="flex flex-wrap justify-center md:justify-start items-center gap-4 text-sm font-medium text-gray-300">
                            <span id="release-year" class="text-green-400 font-bold"></span>
                            <span id="runtime"></span>
                            <span id="vote-average" class="border border-white/30 px-2 py-0.5 rounded text-xs bg-white/10"></span>
                            <span id="genres" class="text-gray-400"></span>
                        </div>

                        <p id="overview" class="text-gray-200 text-lg leading-relaxed max-w-2xl mx-auto md:mx-0 drop-shadow-md"></p>

                        <div class="flex flex-col sm:flex-row gap-4 pt-4 justify-center md:justify-start">
                            <a id="play-btn" href="#" class="flex items-center justify-center bg-red-600 text-white px-8 py-3 rounded hover:bg-red-700 transition font-bold text-lg shadow-lg">
                                <i class="fas fa-play mr-3"></i> Lecture
                            </a>
                            <button onclick="document.getElementById('trailer-section').scrollIntoView({behavior: 'smooth'})" class="flex items-center justify-center bg-gray-600/60 hover:bg-gray-600/80 text-white px-6 py-3 rounded transition font-semibold backdrop-blur-sm">
                                <i class="fas fa-film mr-3"></i> Bande-annonce
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="bg-[#141414] relative z-20 -mt-10 rounded-t-3xl border-t border-white/5 shadow-[0_-10px_40px_rgba(0,0,0,1)]">
            <div class="container mx-auto px-6 py-12 space-y-16">
                
                <section>
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-3 text-gray-200">
                        <i class="fas fa-users text-red-600"></i> Casting Principal
                    </h2>
                    <div id="cast-list" class="flex overflow-x-auto gap-6 pb-6 no-scrollbar snap-x">
                        </div>
                </section>

                <section id="trailer-section">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-3 text-gray-200">
                        <i class="fab fa-youtube text-red-600"></i> Bandes-annonces & Vidéos
                    </h2>
                    <div id="trailer-container" class="aspect-video w-full max-w-4xl mx-auto bg-black rounded-xl overflow-hidden shadow-2xl border border-gray-800">
                        <div class="flex h-full items-center justify-center text-gray-500">
                            <i class="fas fa-video-slash text-4xl mb-2"></i><br>Aucune vidéo disponible
                        </div>
                    </div>
                </section>
            </div>
            
            <footer class="text-center text-gray-600 py-8 border-t border-gray-900 text-sm">
                Code généré pour test • API TMDB
            </footer>
        </div>
    </div>

    <script>
        // CONFIGURATION API
        const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';
        
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/original';
        const POSTER_SIZE = 'https://image.tmdb.org/t/p/w500';
        const PROFILE_SIZE = 'https://image.tmdb.org/t/p/w185';

        // INITIALISATION
        async function init() {
            const queryString = window.location.search;
            const movieId = queryString ? queryString.substring(1) : null;

            if (!movieId) {
                // Redirection auto si pas d'ID (optionnel)
                window.location.href = 'index.html'; 
                return;
            }

            const options = {
                method: 'GET',
                headers: { accept: 'application/json', Authorization: `Bearer ${TMDB_TOKEN}` }
            };

            try {
                const [detailsRes, creditsRes, videosRes, imagesRes] = await Promise.all([
                    fetch(`${BASE_URL}/movie/${movieId}?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/credits?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/videos?language=fr-FR`, options),
                    fetch(`${BASE_URL}/movie/${movieId}/images`, options)
                ]);

                if (!detailsRes.ok) throw new Error("Film introuvable");

                const movie = await detailsRes.json();
                const credits = await creditsRes.json();
                const videos = await videosRes.json();
                const images = await imagesRes.json();

                populateUI(movie, credits, videos, images);

            } catch (err) {
                console.error(err);
                alert("Erreur de chargement. Retour à l'accueil.");
                window.location.href = 'index.html';
            } finally {
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
            }
        }

        function populateUI(movie, credits, videos, images) {
            // Meta Données
            document.title = movie.title;
            document.getElementById('movie-title').textContent = movie.title;
            document.getElementById('overview').textContent = movie.overview || "Résumé indisponible.";
            document.getElementById('release-year').textContent = movie.release_date ? movie.release_date.split('-')[0] : '';
            
            const hours = Math.floor(movie.runtime / 60);
            const mins = movie.runtime % 60;
            document.getElementById('runtime').textContent = `${hours}h ${mins}min`;
            document.getElementById('vote-average').textContent = `${movie.vote_average.toFixed(1)}/10`;
            document.getElementById('genres').textContent = movie.genres.slice(0,3).map(g => g.name).join(' • ');

            // Images de fond
            if (movie.backdrop_path) {
                document.getElementById('hero-bg').style.backgroundImage = `url('${IMAGE_BASE_URL}${movie.backdrop_path}')`;
            }

            // Affiche (Poster)
            if (movie.poster_path) {
                document.getElementById('poster-img').src = `${POSTER_SIZE}${movie.poster_path}`;
            } else {
                // Si pas d'affiche, on cache le bloc image pour centrer le texte
                document.getElementById('poster-img').parentElement.style.display = 'none';
            }

            // Logo (Cherche un logo PNG pour remplacer le titre texte)
            const logos = images.logos.filter(l => l.iso_639_1 === 'fr' || l.iso_639_1 === 'en');
            if (logos.length > 0) {
                const logoUrl = `${IMAGE_BASE_URL}${logos[0].file_path}`;
                const logoImg = document.createElement('img');
                logoImg.src = logoUrl;
                logoImg.alt = movie.title;
                logoImg.className = "max-h-32 w-auto object-contain drop-shadow-lg"; 
                
                const titleContainer = document.getElementById('movie-logo-container');
                titleContainer.innerHTML = '';
                titleContainer.appendChild(logoImg);
                // Ajustement alignment container
                titleContainer.className = "mb-4 flex justify-center md:justify-start";
            }

            // Bouton Play
            document.getElementById('play-btn').href = `${movie.id}.html`;

            // Casting
            const castContainer = document.getElementById('cast-list');
            const topCast = credits.cast.slice(0, 10);
            if(topCast.length) {
                topCast.forEach(actor => {
                    if (actor.profile_path) {
                        const div = document.createElement('div');
                        div.className = "flex-none w-32 snap-start group cursor-pointer";
                        div.innerHTML = `
                            <div class="w-24 h-24 mx-auto mb-3 rounded-full overflow-hidden border-2 border-transparent group-hover:border-red-600 transition shadow-lg relative">
                                <img src="${PROFILE_SIZE}${actor.profile_path}" class="w-full h-full object-cover">
                            </div>
                            <div class="text-center">
                                <h3 class="text-white text-sm font-bold truncate">${actor.name}</h3>
                                <p class="text-gray-500 text-xs truncate">${actor.character}</p>
                            </div>
                        `;
                        castContainer.appendChild(div);
                    }
                });
            } else {
                castContainer.innerHTML = '<p class="text-gray-500 italic">Casting non disponible</p>';
            }

            // Trailer
            let trailer = videos.results.find(v => v.site === 'YouTube' && v.type === 'Trailer');
            if (!trailer) trailer = videos.results.find(v => v.site === 'YouTube'); // Fallback

            if (trailer) {
                document.getElementById('trailer-container').innerHTML = `
                    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/${trailer.key}" title="Trailer" frameborder="0" allowfullscreen></iframe>
                `;
            }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
