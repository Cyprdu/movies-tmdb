<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lecteur Live + Cast</title>
    <link rel="icon" type="image/png" href="favico.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
    <script defer src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Styles existants conservés */
        body,html{margin:0;padding:0;background:#000;height:100%;font-family:'Roboto',sans-serif;overflow:hidden;color:#fff;user-select:none;-webkit-user-select:none}
        body.hide-cursor{cursor:none!important}
        body.hide-cursor *{cursor:none!important}
        @media screen and (display-mode:picture-in-picture){body{display:none!important}}
        #player-container{position:relative;width:100%;height:100%;background:#000;overflow:hidden}
        video{width:100%;height:100%;display:block;object-fit:contain}
        #click-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5}
        body.hide-cursor #click-layer{cursor:none!important}
        #ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;display:flex;flex-direction:column;justify-content:space-between;opacity:0;transition:opacity 0.2s ease-out;pointer-events:none}
        #ui-layer.visible{opacity:1}
        #subtitle-container{position:absolute;width:100%;bottom:100px;display:flex;justify-content:center;pointer-events:none!important;z-index:200;transition:bottom 0.2s ease-out}
        #subtitle-container.controls-visible{bottom:140px}
        #subtitle-container span{font-size:clamp(24px, 4vw, 42px);color:#fff;text-shadow:0 0 8px rgb(0 0 0 / .95),0 0 12px rgb(0 0 0 / .8);background:#fff0;font-weight:500;padding:4px 12px;white-space:pre-line;text-align:center}
        .top-bar{padding:25px 40px;background:linear-gradient(to bottom,rgb(0 0 0 / .8) 0%,transparent 100%);display:flex;justify-content:space-between;align-items:center;position:relative;z-index:100;pointer-events:auto}
        .top-left{display:flex;align-items:center;gap:15px;font-size:15px;color:#ccc;font-weight:500;width:100px}
        .top-title{position:absolute;left:50%;top:30px;transform:translateX(-50%);font-size:18px;color:#fff;text-shadow:0 1px 4px rgb(0 0 0 / .8);pointer-events:none;font-weight:700}
        .top-icons{display:flex;gap:24px;align-items:center}
        .icon-btn{width:25px;height:25px;color:rgb(255 255 255 / .7);cursor:pointer;transition:transform 0.15s,color 0.15s;display:flex;align-items:center;justify-content:center;position:relative}
        .icon-btn:hover{transform:scale(1.15);color:#fff}
        .icon-btn svg{width:100%;height:100%}
        /* Style spécifique pour l'icône Cast quand elle est active */
        .icon-btn.casting { color: #4285F4; }
        
        /* ... Le reste de tes styles (volume, seekbar, menu, etc) ... */
        .top-icons-separator{width:1px;height:22px;background:rgb(255 255 255 / .5)}
        .volume-container{position:relative;display:flex;flex-direction:column;align-items:center;pointer-events:auto}
        .vol-slider-wrapper{position:absolute;top:36px;width:40px;height:0;background:rgb(30 30 30 / .95);border-radius:4px;transition:height 0.2s ease-out;display:flex;align-items:center;justify-content:center;z-index:200;overflow:hidden;box-shadow:0 4px 12px rgb(0 0 0 / .6)}
        .volume-container:hover .vol-slider-wrapper,.vol-slider-wrapper:hover{height:130px}
        .vol-slider-wrapper input[type=range]{transform:rotate(-90deg);width:100px;height:4px;background:rgb(255 255 255 / .2);border-radius:2px;outline:none;-webkit-appearance:none;cursor:pointer}
        input[type=range]::-webkit-slider-thumb{width:14px;height:14px;background:#fff;border-radius:50%;-webkit-appearance:none;cursor:pointer;box-shadow:0 0 3px rgb(0 0 0 / .5)}
        .center-controls{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;align-items:center;gap:80px;pointer-events:auto;z-index:60}
        .center-btn{cursor:pointer;transition:transform 0.15s;color:rgb(255 255 255 / .85);display:flex;align-items:center;justify-content:center}
        .center-btn:hover{transform:scale(1.1);color:#fff}
        .center-btn svg{filter:drop-shadow(0 2px 8px rgb(0 0 0 / .8))}
        .skip-btn{width:50px;height:50px}
        .bottom-bar{padding:0 40px 35px 40px;background:linear-gradient(to top,rgb(0 0 0 / .9) 0%,transparent 100%);display:flex;flex-direction:column;gap:10px;pointer-events:auto;z-index:100}
        .time-display{font-size:14px;color:#ccc;font-weight:500;margin-left:2px; display:flex; align-items:center; gap:10px;}
        .live-badge {background-color: #E50914; color: #fff; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 13px; letter-spacing: 0.5px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s ease;}
        .live-badge::before {content: ''; display: inline-block; width: 6px; height: 6px; background-color: #fff; border-radius: 50%; margin-right: 6px; animation: pulse 1.5s infinite;}
        .live-badge.not-live {background-color: rgb(255 255 255 / .2); color: #aaa; cursor: pointer;}
        .live-badge.not-live::before {animation: none; background-color: #aaa;}
        .live-offset {font-variant-numeric: tabular-nums; font-family: monospace; font-size: 13px;}
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .seek-container{width:100%;height:4px;background:rgb(255 255 255 / .25);cursor:pointer;position:relative;border-radius:2px;transition:height 0.15s}
        .seek-container:hover{height:6px}
        .seek-fill{height:100%;background:#fff;width:0%;border-radius:2px;position:relative}
        .seek-fill::after{content:'';position:absolute;right:-7px;top:50%;transform:translateY(-50%);width:15px;height:15px;background:#fff;border-radius:50%;opacity:0;transition:opacity 0.15s;box-shadow:0 1px 4px rgb(0 0 0 / .5)}
        .menu-popup{position:absolute;top:70px;right:40px;background:rgb(40 40 40 / .97);backdrop-filter:blur(10px);border-radius:4px;padding:8px 0;min-width:340px;display:none;flex-direction:column;z-index:2000;box-shadow:0 8px 24px rgb(0 0 0 / .6);pointer-events:auto}
        .menu-header{padding:12px 20px;color:#fff;font-weight:700;font-size:16px;margin-bottom:4px}
        .menu-section-title{padding:8px 20px;color:#aaa;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
        .menu-popup button{background:#fff0;border:none;color:#bbb;text-align:left;padding:12px 20px 12px 50px;cursor:pointer;font-size:14px;font-weight:400;display:flex;flex-direction:column;width:100%;transition:background 0.15s,color 0.15s;position:relative}
        .menu-popup button:hover{background:rgb(255 255 255 / .1);color:#fff}
        .menu-popup button.active{color:#fff;font-weight:600;background:rgb(255 255 255 / .08)}
        .menu-popup button.active::before{content:'';position:absolute;left:20px;top:50%;transform:translateY(-50%);width:19px;height:15px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOSIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE5IDE1Ij48dGl0bGU+UmVjdGFuZ2xlIDUwICsgUmVjdGFuZ2xlIDUwIENvcHk8L3RpdGxlPjxnIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTIuMTIxIDZsNi4zNjQgNi4zNjQtMi4xMjEgMi4xMjJMMCA4LjEyMnoiLz48cGF0aCBkPSJNMTguNzI4IDIuMTIxTDcuMTIgMTMuNzI4IDUgMTEuNjA3IDE2LjYwNyAwbDIuMTIgMi4xMjF6Ii8+PC9nPjwvc3ZnPg==);background-size:contain;background-repeat:no-repeat}
        .menu-subtext{font-size:12px;color:#888;margin-top:3px;font-weight:400}
        .menu-separator{height:1px;background:rgb(255 255 255 / .1);margin:8px 0;width:100%}
        #security-warning{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9999;text-align:center}
    </style>
</head>
<body id="main-body" oncontextmenu="return false;">
    <div id="security-warning">
        <h1>Lecture impossible</h1>
        <p>Votre navigateur ou environnement n'est pas sécurisé.</p>
    </div>
        
    <div id="player-container">
        <video id="video"></video>
        <div id="subtitle-container"></div>
        <div id="click-layer"></div>
                
        <div id="ui-layer">
            <div class="top-bar">
                <div class="top-left"></div>
                <div class="top-title" id="movie-title">Chargement...</div>
                <div class="top-icons">
                    <div class="icon-btn" id="cast-btn" title="Cast">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.92-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                        </svg>
                    </div>

                    <div class="icon-btn" id="subs-btn" title="Sous-titres & Audio">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" fill-rule="evenodd" d="M20.773 2.207h-16a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4v-12a4 4 0 0 0-4-4zm-16 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-12a2 2 0 0 0-2-2h-16zm3 9a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1zm-2 3a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2zm5 1a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1z" clip-rule="evenodd"/></svg>
                    </div>
                    
                    <div class="volume-container">
                        <div class="icon-btn" id="vol-btn" title="Volume">
                            <svg id="vol-icon" xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/><path fill="#fff" d="M17.5 12a2 2 0 0 1-2 2v-4a2 2 0 0 1 2 2z"/><path fill="#fff" fill-rule="evenodd" d="M18.536 7.08a.75.75 0 0 1 1.053.125A7.72 7.72 0 0 1 21.25 12a7.72 7.72 0 0 1-1.661 4.795.75.75 0 1 1-1.178-.929A6.22 6.22 0 0 0 19.75 12c0-1.46-.5-2.802-1.339-3.866a.75.75 0 0 1 .125-1.053z" clip-rule="evenodd"/><path fill="#fff" fill-rule="evenodd" d="M20.524 4.438a.75.75 0 0 1 1.055.103 11.705 11.705 0 0 1 2.671 7.46c0 2.83-1.002 5.43-2.67 7.458a.75.75 0 1 1-1.16-.953A10.205 10.205 0 0 0 22.75 12a10.2 10.2 0 0 0-2.33-6.506.75.75 0 0 1 .104-1.056z" clip-rule="evenodd"/></svg>
                        </div>
                        <div class="vol-slider-wrapper">
                            <input type="range" min="0" max="1" step="0.05" value="1" id="vol-range">
                        </div>
                    </div>
                    
                    <div class="icon-btn" id="settings-btn" title="Qualité">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" fill-rule="evenodd" d="M8.6 4.994c-.337.166-.66.353-.97.56l-1.947-.812a1.5 1.5 0 0 0-1.877.634L1.822 8.812a1.5 1.5 0 0 0 .39 1.943l1.678 1.28a8.596 8.596 0 0 0 0 1.118l-1.678 1.28a1.5 1.5 0 0 0-.39 1.943l1.984 3.436a1.5 1.5 0 0 0 1.877.634l1.947-.813c.31.207.633.395.97.56l.269 2.092a1.5 1.5 0 0 0 1.488 1.309h3.967a1.5 1.5 0 0 0 1.488-1.309l.269-2.091c.336-.166.66-.354.97-.561l1.947.813a1.5 1.5 0 0 0 1.877-.634l1.983-3.436a1.5 1.5 0 0 0-.389-1.943l-1.678-1.28a8.63 8.63 0 0 0 0-1.118l1.678-1.28a1.5 1.5 0 0 0 .39-1.943l-1.984-3.436a1.5 1.5 0 0 0-1.877-.634l-1.948.813a8.454 8.454 0 0 0-.969-.561l-.27-2.092a1.5 1.5 0 0 0-1.487-1.308h-3.967a1.5 1.5 0 0 0-1.488 1.308l-.27 2.092zm1.834 1.416A6.48 6.48 0 0 0 7.94 7.852L5.318 6.757 3.774 9.43l2.258 1.722a6.49 6.49 0 0 0 0 2.881l-2.258 1.723 1.544 2.674 2.622-1.095a6.462 6.462 0 0 0 2.494 1.441l.362 2.817h3.088l.363-2.817c.94-.29 1.79-.788 2.493-1.441l2.623 1.095 1.544-2.674-2.259-1.723a6.489 6.489 0 0 0 0-2.88l2.259-1.723-1.544-2.674-2.623 1.095a6.461 6.461 0 0 0-2.493-1.441l-.363-2.817h-3.088l-.362 2.816zm1.906 10.184a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" clip-rule="evenodd"/></svg>
                    </div>

                    <div class="icon-btn" id="pip-btn" title="PiP">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="9" height="6" x="11" y="11.99" fill="#fff" rx="1"/><rect width="22" height="18" x="1" y="3" stroke="#fff" stroke-width="2" rx="3"/></svg>
                    </div>

                    <div class="icon-btn" id="fullscreen-btn" title="Plein écran">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" d="M4.746 8.056V6.294L18.73 20.278h-1.762a1.111 1.111 0 1 0 0 2.222h4.444a1.11 1.11 0 0 0 1.111-1.111v-4.445a1.111 1.111 0 0 0-2.222 0v1.762L6.317 4.722h1.762a1.111 1.111 0 1 0 0-2.222H3.635c-.614 0-1.112.497-1.112 1.111v4.445a1.111 1.111 0 1 0 2.223 0z"/></svg>
                    </div>

                    <div class="top-icons-separator"></div>

                    <a href="javascript:window.close();" class="icon-btn" id="close-btn" title="Fermer" style="text-decoration:none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" fill-rule="evenodd" d="M4.691 4.667a1 1 0 0 1 1.415 0l6.418 6.419 6.42-6.42a1 1 0 1 1 1.414 1.415l-6.42 6.419 6.42 6.419a1 1 0 0 1-1.415 1.414l-6.419-6.419-6.418 6.42a1 1 0 0 1-1.415-1.415l6.42-6.419-6.42-6.419a1 1 0 0 1 0-1.414z" clip-rule="evenodd"/></svg>
                    </a>
                </div>
            </div>
            
            <div class="center-controls">
                <div class="center-btn skip-btn" id="skip-back">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="none" viewBox="0 0 67 67"><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M33.5 0C52 0 67 15 67 33.5S52 67 33.5 67 0 52 0 33.5c.03-1.4 1.17-2.53 2.58-2.53 1.4 0 2.55 1.13 2.57 2.53 0 15.65 12.7 28.35 28.35 28.35 15.66 0 28.35-12.7 28.35-28.35 0-15.66-12.69-28.35-28.35-28.35h-.04c-7 0-13.76 2.61-18.94 7.3-.46.42-.91.85-1.34 1.29h6.58c1.42 0 2.57 1.16 2.57 2.58 0 1.42-1.15 2.58-2.57 2.58H6.01c-1.42 0-2.57-1.16-2.57-2.58V2.58C3.44 1.15 4.59 0 6.01 0c1.43 0 2.58 1.15 2.58 2.58v8.52c.78-.86 1.61-1.7 2.47-2.47A33.407 33.407 0 0 1 33.46 0h.04zm.48 41.34c-1.6-2.21-2-5.2-2-7.85 0-2.65.4-5.63 2-7.83 1.44-1.97 3.47-2.84 5.88-2.84 2.41 0 4.42.87 5.86 2.84 1.61 2.21 2.03 5.16 2.03 7.83 0 2.66-.4 5.64-2 7.85-1.43 1.97-3.47 2.84-5.89 2.84-2.41 0-4.45-.86-5.88-2.84zm-9.73-12.77l-5 1.58v-4.21l5.87-2.65h4.28v20.47h-5.15V28.57zm17.61 9.96c.61-1.33.68-3.6.68-5.04s-.07-3.7-.68-5.02c-.4-.86-1.04-1.29-2-1.29-.95 0-1.59.42-1.99 1.29-.61 1.32-.68 3.58-.68 5.02 0 1.44.07 3.71.68 5.04.4.87 1.04 1.29 1.99 1.29.96 0 1.6-.42 2-1.29z"/></svg>
                </div>
                <div class="center-btn" id="center-play-btn">
                    <svg id="icon-play" xmlns="http://www.w3.org/2000/svg" width="67" height="67" fill="none" viewBox="0 0 67 67"><path fill="#fff" d="M20.28 9.65c-2.205-1.268-4.026-.228-4.026 2.307v43.805c0 2.535 1.82 3.574 4.027 2.307l38.471-21.903a2.556 2.556 0 0 0 1.094-.935 2.514 2.514 0 0 0 0-2.743 2.556 2.556 0 0 0-1.093-.936L20.28 9.65z"/></svg>
                    <svg id="icon-pause" xmlns="http://www.w3.org/2000/svg" width="67" height="67" fill="none" viewBox="0 0 67 67" style="display:none"><path fill="#fff" fill-rule="evenodd" d="M46.332 5.773a4.125 4.125 0 0 0-4.125 4.125v46.75a4.127 4.127 0 0 0 4.125 4.125 4.127 4.127 0 0 0 4.125-4.125V9.898a4.125 4.125 0 0 0-4.125-4.125zM25.707 9.898v46.75a4.125 4.125 0 1 1-8.25 0V9.898a4.123 4.123 0 0 1 4.125-4.125 4.123 4.123 0 0 1 4.125 4.125z" clip-rule="evenodd"/></svg>
                </div>
                <div class="center-btn skip-btn" id="skip-forward">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="none" viewBox="0 0 67 67"><path fill="#fff" fill-rule="evenodd" d="M33.5 0C15 0 0 15 0 33.5S15 67 33.5 67 67 52 67 33.5a2.583 2.583 0 0 0-2.58-2.53c-1.4 0-2.55 1.13-2.57 2.53 0 15.66-12.69 28.35-28.35 28.35-15.65 0-28.35-12.7-28.35-28.35 0-15.66 12.7-28.35 28.35-28.35 7.3 0 13.96 2.76 18.99 7.3.46.42.9.85 1.34 1.29h-6.59a2.58 2.58 0 0 0 0 5.16h13.75c1.42 0 2.57-1.16 2.57-2.58V2.58c0-1.43-1.15-2.58-2.57-2.58-1.43 0-2.58 1.15-2.58 2.58v8.52c-.78-.87-1.61-1.7-2.47-2.48A33.446 33.446 0 0 0 33.54 0h-.04zm.48 41.34c-1.6-2.21-2-5.2-2-7.85 0-2.65.4-5.63 2-7.83 1.44-1.97 3.47-2.84 5.88-2.84 2.41 0 4.42.87 5.86 2.84 1.61 2.21 2.03 5.16 2.03 7.83 0 2.66-.4 5.64-2 7.85-1.43 1.97-3.47 2.84-5.89 2.84-2.41 0-4.45-.87-5.88-2.84zm-9.73-12.77l-5 1.58v-4.21l5.87-2.65h4.28v20.47h-5.15V28.57zm17.61 9.96c.61-1.33.68-3.6.68-5.04s-.07-3.7-.68-5.02c-.4-.87-1.04-1.29-2-1.29-.95 0-1.59.42-1.99 1.29-.61 1.32-.68 3.58-.68 5.02 0 1.44.07 3.71.68 5.04.4.86 1.04 1.28 1.99 1.28.96 0 1.6-.42 2-1.28z"/></svg>
                </div>
            </div>
            
            <div class="bottom-bar">
                <div class="time-display" id="time-display">
                    <span class="live-badge" id="live-badge-btn" title="Retour au direct">DIRECT</span>
                    <span class="live-offset" id="live-offset-text"></span>
                </div>
                <div class="seek-container" id="seek-container">
                    <div class="seek-fill" id="seek-fill"></div>
                </div>
            </div>
            
            <div class="menu-popup" id="menu-subs"></div>
            <div class="menu-popup" id="menu-settings"></div>
        </div>
    </div>

    <script>
        const MOVIE_CONFIG = {
            "channel_name": "Ligue 1+",
            "mpd_url": "https://dice-live-eu.cdnfastly.endeavorstreaming.net/1771695216_H25m104Fbk5MMpk7_31fa04c76a34de697de5f42bda714f6d7fd519b3/id=832687d1-4e88-4be7-af96-576fc2ddcc5f/data=dWlkPXNSYnhVbnxlOGZmNWIyZS0yYzZkLTRmODctODJjZi00ZWE0MzdhNGM5OGUmaXA9MmEwMTplMGE6ZWExOjI3MjA6NmE0NDoyZGIwOmQ3ODM6NGVjNiZleHA9MTc3MTY5NTI0NSZlaWQ9Mjk2MzczJmNpZD1kY2UubGlndWV1biZvaWQ9MzQ2JnR5cGU9TElWRQ/dash/live/2019662~/dash/live/2019662/296373-316951/manifest-d.mpd",
            "drm_key": {
                "d99effb979a4482a82dbab8576bca393": "b85774149e9c4dd88767bd42fec27e79"
            }
        };

        const video = document.getElementById('video');
        const movieTitle = document.getElementById('movie-title');
        const castBtn = document.getElementById('cast-btn');
        
        let player, castProxy;
        let playerLoaded = false;

        async function init() {
            shaka.polyfill.installAll();
            if (!shaka.Player.isBrowserSupported()) return;

            // 1. Initialisation du Player local
            player = new shaka.Player(video);
            
            // 2. Configuration du Cast Proxy
            // App ID par défaut pour Shaka (shaka-player-ui)
            castProxy = new shaka.cast.CastProxy(video, player, 'CC1AD845');

            player.configure({
                streaming: { alwaysStreamText: true },
                drm: { clearKeys: MOVIE_CONFIG.drm_key },
                abr: { enabled: true }
            });

            // Gestion du clic Cast
            castBtn.addEventListener('click', async () => {
                if (castProxy.isCasting()) {
                    castProxy.suggestDisconnect();
                } else {
                    try {
                        await castProxy.cast();
                    } catch (e) {
                        console.error("Erreur Cast:", e);
                    }
                }
            });

            // Écouter les changements d'état Cast pour changer la couleur de l'icône
            castProxy.addEventListener('caststatuschanged', () => {
                const isCasting = castProxy.isCasting();
                castBtn.classList.toggle('casting', isCasting);
                console.log(isCasting ? "Casting en cours..." : "Lecture locale.");
            });

            try {
                // Utilisation du proxy pour charger (ça charge soit sur video, soit sur Chromecast)
                const targetPlayer = castProxy.getPlayer();
                await targetPlayer.load(MOVIE_CONFIG.mpd_url);
                playerLoaded = true;
                movieTitle.textContent = MOVIE_CONFIG.channel_name;
            } catch (e) {
                console.error('Erreur de chargement:', e);
            }
        }

        // --- Logique UI existante (simplifiée pour l'exemple) ---
        // (Copie ici toute ta logique de skip, volume, fullscreen, etc.)
        // IMPORTANT : Utilise `castProxy.getVideo()` au lieu de `video` 
        // et `castProxy.getPlayer()` au lieu de `player` dans tes fonctions
        // pour que les contrôles pilotent aussi le Chromecast.

        document.getElementById('center-play-btn').addEventListener('click', () => {
            const v = castProxy.getVideo();
            if (v.paused) v.play(); else v.pause();
        });

        // Mise à jour UI Play/Pause
        video.addEventListener('play', () => {
            document.getElementById('icon-play').style.display = 'none';
            document.getElementById('icon-pause').style.display = 'block';
        });
        video.addEventListener('pause', () => {
            document.getElementById('icon-play').style.display = 'block';
            document.getElementById('icon-pause').style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
