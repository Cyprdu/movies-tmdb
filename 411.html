<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lecteur</title>
<link rel="icon" type="image/png" href="favico.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
body,html{margin:0;padding:0;background:#000;height:100%;font-family:'Roboto',sans-serif;overflow:hidden;color:#fff;user-select:none;-webkit-user-select:none}
body.hide-cursor{cursor:none!important}
body.hide-cursor *{cursor:none!important}
#player-container{position:relative;width:100%;height:100%;background:#000;overflow:hidden}
video{width:100%;height:100%;display:block;object-fit:contain}
#click-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5}
body.hide-cursor #click-layer{cursor:none!important}
#ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;display:flex;flex-direction:column;justify-content:space-between;opacity:0;transition:opacity 0.2s ease-out;pointer-events:none}
#ui-layer.visible{opacity:1}
#subtitle-container{position:absolute;width:100%;bottom:100px;display:flex;justify-content:center;pointer-events:none!important;z-index:200;transition:bottom 0.2s ease-out}
#subtitle-container.controls-visible{bottom:140px}
#subtitle-container span{font-size:clamp(24px,4vw,42px);color:#fff;text-shadow:0 0 8px rgb(0 0 0/.95),0 0 12px rgb(0 0 0/.8);background:#fff0;font-weight:500;padding:4px 12px;white-space:pre-line;text-align:center}
.skip-sequence-btn{position:absolute;bottom:140px;right:40px;background:rgb(255 255 255/.95);color:#000;padding:14px 28px;border:none;border-radius:4px;font-size:16px;font-weight:700;cursor:pointer;z-index:250;transition:all 0.2s;display:none;pointer-events:auto}
.skip-sequence-btn:hover{background:#fff;transform:scale(1.05)}
#xray-sidebar{position:absolute;left:0;top:0;width:340px;height:calc(100% - 140px);background:linear-gradient(to right,rgb(0 0 0/.85) 0%,transparent 100%);padding:80px 20px 20px 30px;overflow-y:auto;z-index:55;pointer-events:auto;display:none}
#xray-sidebar::-webkit-scrollbar{width:6px}
#xray-sidebar::-webkit-scrollbar-track{background:#fff0}
#xray-sidebar::-webkit-scrollbar-thumb{background:rgb(255 255 255/.3);border-radius:3px}
.actor-item{display:flex;gap:12px;margin-bottom:20px;cursor:pointer;transition:transform 0.2s}
.actor-item:hover{transform:scale(1.02)}
.actor-photo{width:80px;height:120px;object-fit:cover;border-radius:4px;background:#222}
.actor-info{display:flex;flex-direction:column;justify-content:center}
.actor-name{font-size:15px;font-weight:700;color:#fff;margin-bottom:4px}
.actor-character{font-size:13px;color:#aaa;font-weight:400}
.top-bar{padding:25px 40px;background:linear-gradient(to bottom,rgb(0 0 0/.8) 0%,transparent 100%);display:flex;justify-content:space-between;align-items:center;position:relative;z-index:100;pointer-events:auto}
.top-left{display:flex;align-items:center;gap:15px;font-size:15px;color:#ccc;font-weight:500;cursor:pointer}
.top-left:hover{color:#fff}
.xray-text{font-weight:700;color:#fff;font-size:16px}
.imdb-logo{background:#E2B616;color:#000;padding:2px 5px;border-radius:2px;font-weight:900;font-size:12px;letter-spacing:-.5px}
.top-title{position:absolute;left:50%;top:30px;transform:translateX(-50%);font-size:18px;color:#fff;text-shadow:0 1px 4px rgb(0 0 0/.8);pointer-events:none;font-weight:700}
.top-icons{display:flex;gap:24px;align-items:center}
.icon-btn{width:25px;height:25px;color:rgb(255 255 255/.7);cursor:pointer;transition:transform 0.15s,color 0.15s;display:flex;align-items:center;justify-content:center;position:relative}
.icon-btn:hover{transform:scale(1.15);color:#fff}
.icon-btn svg{width:100%;height:100%}
.top-icons-separator{width:1px;height:22px;background:rgb(255 255 255/.5)}
.volume-container{position:relative;display:flex;flex-direction:column;align-items:center;pointer-events:auto}
.vol-slider-wrapper{position:absolute;top:36px;width:40px;height:0;background:rgb(30 30 30/.95);border-radius:4px;transition:height 0.2s ease-out;display:flex;align-items:center;justify-content:center;z-index:200;overflow:hidden;box-shadow:0 4px 12px rgb(0 0 0/.6)}
.volume-container:hover .vol-slider-wrapper,.vol-slider-wrapper:hover{height:130px}
.vol-slider-wrapper input[type=range]{transform:rotate(-90deg);width:100px;height:4px;background:rgb(255 255 255/.2);border-radius:2px;outline:none;-webkit-appearance:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{width:14px;height:14px;background:#fff;border-radius:50%;-webkit-appearance:none;cursor:pointer;box-shadow:0 0 3px rgb(0 0 0/.5)}
.center-controls{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;align-items:center;gap:80px;pointer-events:auto;z-index:60}
.center-btn{cursor:pointer;transition:transform 0.15s;color:rgb(255 255 255/.85);display:flex;align-items:center;justify-content:center}
.center-btn:hover{transform:scale(1.1);color:#fff}
.center-btn svg{filter:drop-shadow(0 2px 8px rgb(0 0 0/.8))}
.skip-btn{width:50px;height:50px}
.bottom-bar{padding:0 40px 35px 40px;background:linear-gradient(to top,rgb(0 0 0/.9) 0%,transparent 100%);display:flex;flex-direction:column;gap:10px;pointer-events:auto;z-index:100}
.time-display{font-size:14px;color:#ccc;font-weight:500;margin-left:2px}
.seek-container{width:100%;height:4px;background:rgb(255 255 255/.25);cursor:pointer;position:relative;border-radius:2px;transition:height 0.15s}
.seek-container:hover{height:6px}
.seek-fill{height:100%;background:#fff;width:0%;border-radius:2px;position:relative}
.seek-fill::after{content:'';position:absolute;right:-7px;top:50%;transform:translateY(-50%);width:15px;height:15px;background:#fff;border-radius:50%;opacity:0;transition:opacity 0.15s;box-shadow:0 1px 4px rgb(0 0 0/.5)}
.seek-container:hover .seek-fill::after{opacity:1}
.menu-popup{position:absolute;top:70px;right:40px;background:rgb(40 40 40/.97);backdrop-filter:blur(10px);border-radius:4px;padding:8px 0;min-width:340px;display:none;flex-direction:column;z-index:2000;box-shadow:0 8px 24px rgb(0 0 0/.6);pointer-events:auto}
.menu-header{padding:12px 20px;color:#fff;font-weight:700;font-size:16px;margin-bottom:4px}
.menu-section-title{padding:8px 20px;color:#aaa;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.menu-popup button{background:#fff0;border:none;color:#bbb;text-align:left;padding:12px 20px 12px 50px;cursor:pointer;font-size:14px;font-weight:400;display:flex;flex-direction:column;width:100%;transition:background 0.15s,color 0.15s;position:relative}
.menu-popup button:hover{background:rgb(255 255 255/.1);color:#fff}
.menu-popup button.active{color:#fff;font-weight:600;background:rgb(255 255 255/.08)}
.menu-popup button.active::before{content:'';position:absolute;left:20px;top:50%;transform:translateY(-50%);width:19px;height:15px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOSIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE5IDE1Ij48dGl0bGU+UmVjdGFuZ2xlIDUwICsgUmVjdGFuZ2xlIDUwIENvcHk8L3RpdGxlPjxnIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTIuMTIxIDZsNi4zNjQgNi4zNjQtMi4xMjEgMi4xMjJMMCA4LjEyMnoiLz48cGF0aCBkPSJNMTguNzI4IDIuMTIxTDcuMTIgMTMuNzI4IDUgMTEuNjA3IDE2LjYwNyAwbDIuMTIgMi4xMjF6Ii8+PC9nPjwvc3ZnPg==);background-size:contain;background-repeat:no-repeat}
.menu-subtext{font-size:12px;color:#888;margin-top:3px;font-weight:400}
.menu-separator{height:1px;background:rgb(255 255 255/.1);margin:8px 0;width:100%}
#error-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgb(0 0 0/.85);color:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9999;text-align:center;gap:12px}
#error-overlay h2{margin:0;font-size:22px}
#error-overlay p{margin:0;color:#aaa;font-size:14px}
#loading-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:80;display:flex;align-items:center;justify-content:center}
.spinner{width:48px;height:48px;border:4px solid rgb(255 255 255/.2);border-top-color:#fff;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body id="main-body" oncontextmenu="return false;">

<div id="player-container">
  <video id="video" playsinline></video>

  <div id="loading-overlay"><div class="spinner" id="spinner" style="display:none"></div></div>
  <div id="error-overlay">
    <h2>Erreur de lecture</h2>
    <p id="error-msg">Impossible de charger le flux.</p>
  </div>

  <div id="subtitle-container"></div>
  <button id="skip-intro-btn" class="skip-sequence-btn">Passer l'introduction</button>
  <button id="skip-credits-btn" class="skip-sequence-btn">Fin du film</button>

  <div id="click-layer"></div>

  <div id="ui-layer">
    <div id="xray-sidebar"></div>

    <div class="top-bar">
      <div class="top-left" id="xray-toggle">
        <span class="xray-text">X-Ray</span>
        <span class="imdb-logo">IMDb</span>
        <span>Tout ></span>
      </div>
      <div class="top-title" id="movie-title">Chargement...</div>
      <div class="top-icons">
        <div class="icon-btn" id="subs-btn" title="Sous-titres & Audio">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25">
            <path fill="#fff" fill-rule="evenodd" d="M20.773 2.207h-16a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4v-12a4 4 0 0 0-4-4zm-16 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-12a2 2 0 0 0-2-2h-16zm3 9a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1zm-2 3a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2zm5 1a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="volume-container">
          <div class="icon-btn" id="vol-btn" title="Volume">
            <svg id="vol-icon" xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24">
              <path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/>
              <path fill="#fff" d="M17.5 12a2 2 0 0 1-2 2v-4a2 2 0 0 1 2 2z"/>
              <path fill="#fff" fill-rule="evenodd" d="M18.536 7.08a.75.75 0 0 1 1.053.125A7.72 7.72 0 0 1 21.25 12a7.72 7.72 0 0 1-1.661 4.795.75.75 0 1 1-1.178-.929A6.22 6.22 0 0 0 19.75 12c0-1.46-.5-2.802-1.339-3.866a.75.75 0 0 1 .125-1.053z" clip-rule="evenodd"/>
              <path fill="#fff" fill-rule="evenodd" d="M20.524 4.438a.75.75 0 0 1 1.055.103 11.705 11.705 0 0 1 2.671 7.46c0 2.83-1.002 5.43-2.67 7.458a.75.75 0 1 1-1.16-.953A10.205 10.205 0 0 0 22.75 12a10.2 10.2 0 0 0-2.33-6.506.75.75 0 0 1 .104-1.056z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="vol-slider-wrapper">
            <input type="range" min="0" max="1" step="0.05" value="1" id="vol-range">
          </div>
        </div>
        <div class="icon-btn" id="settings-btn" title="Qualité">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25">
            <path fill="#fff" fill-rule="evenodd" d="M8.6 4.994c-.337.166-.66.353-.97.56l-1.947-.812a1.5 1.5 0 0 0-1.877.634L1.822 8.812a1.5 1.5 0 0 0 .39 1.943l1.678 1.28a8.596 8.596 0 0 0 0 1.118l-1.678 1.28a1.5 1.5 0 0 0-.39 1.943l1.984 3.436a1.5 1.5 0 0 0 1.877.634l1.947-.813c.31.207.633.395.97.56l.269 2.092a1.5 1.5 0 0 0 1.488 1.309h3.967a1.5 1.5 0 0 0 1.488-1.309l.269-2.091c.336-.166.66-.354.97-.561l1.947.813a1.5 1.5 0 0 0 1.877-.634l1.983-3.436a1.5 1.5 0 0 0-.389-1.943l-1.678-1.28a8.63 8.63 0 0 0 0-1.118l1.678-1.28a1.5 1.5 0 0 0 .39-1.943l-1.984-3.436a1.5 1.5 0 0 0-1.877-.634l-1.948.813a8.454 8.454 0 0 0-.969-.561l-.27-2.092a1.5 1.5 0 0 0-1.487-1.308h-3.967a1.5 1.5 0 0 0-1.488 1.308l-.27 2.092zm1.834 1.416A6.48 6.48 0 0 0 7.94 7.852L5.318 6.757 3.774 9.43l2.258 1.722a6.49 6.49 0 0 0 0 2.881l-2.258 1.723 1.544 2.674 2.622-1.095a6.462 6.462 0 0 0 2.494 1.441l.362 2.817h3.088l.363-2.817c.94-.29 1.79-.788 2.493-1.441l2.623 1.095 1.544-2.674-2.259-1.723a6.489 6.489 0 0 0 0-2.88l2.259-1.723-1.544-2.674-2.623 1.095a6.461 6.461 0 0 0-2.493-1.441l-.363-2.817h-3.088l-.362 2.816zm1.906 10.184a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="icon-btn" id="pip-btn" title="Picture-in-Picture">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <rect width="9" height="6" x="11" y="11.99" fill="#fff" rx="1"/>
            <rect width="22" height="18" x="1" y="3" stroke="#fff" stroke-width="2" rx="3"/>
          </svg>
        </div>
        <div class="icon-btn" id="fullscreen-btn" title="Plein écran">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25">
            <path fill="#fff" d="M4.746 8.056V6.294L18.73 20.278h-1.762a1.111 1.111 0 1 0 0 2.222h4.444a1.11 1.11 0 0 0 1.111-1.111v-4.445a1.111 1.111 0 0 0-2.222 0v1.762L6.317 4.722h1.762a1.111 1.111 0 1 0 0-2.222H3.635c-.614 0-1.112.497-1.112 1.111v4.445a1.111 1.111 0 1 0 2.223 0z"/>
          </svg>
        </div>
        <div class="top-icons-separator"></div>
        <a href="info?605735" class="icon-btn" id="close-btn" title="Fermer" style="text-decoration:none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25">
            <path fill="#fff" fill-rule="evenodd" d="M4.691 4.667a1 1 0 0 1 1.415 0l6.418 6.419 6.42-6.42a1 1 0 1 1 1.414 1.415l-6.42 6.419 6.42 6.419a1 1 0 0 1-1.415 1.414l-6.419-6.419-6.418 6.42a1 1 0 0 1-1.415-1.415l6.42-6.419-6.42-6.419a1 1 0 0 1 0-1.414z" clip-rule="evenodd"/>
          </svg>
        </a>
      </div>
    </div>

    <div class="center-controls">
      <div class="center-btn skip-btn" id="skip-back">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="none" viewBox="0 0 67 67">
          <path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M33.5 0C52 0 67 15 67 33.5S52 67 33.5 67 0 52 0 33.5c.03-1.4 1.17-2.53 2.58-2.53 1.4 0 2.55 1.13 2.57 2.53 0 15.65 12.7 28.35 28.35 28.35 15.66 0 28.35-12.7 28.35-28.35 0-15.66-12.69-28.35-28.35-28.35h-.04c-7 0-13.76 2.61-18.94 7.3-.46.42-.91.85-1.34 1.29h6.58c1.42 0 2.57 1.16 2.57 2.58 0 1.42-1.15 2.58-2.57 2.58H6.01c-1.42 0-2.57-1.16-2.57-2.58V2.58C3.44 1.15 4.59 0 6.01 0c1.43 0 2.58 1.15 2.58 2.58v8.52c.78-.86 1.61-1.7 2.47-2.47A33.407 33.407 0 0 1 33.46 0h.04zm.48 41.34c-1.6-2.21-2-5.2-2-7.85 0-2.65.4-5.63 2-7.83 1.44-1.97 3.47-2.84 5.88-2.84 2.41 0 4.42.87 5.86 2.84 1.61 2.21 2.03 5.16 2.03 7.83 0 2.66-.4 5.64-2 7.85-1.43 1.97-3.47 2.84-5.89 2.84-2.41 0-4.45-.86-5.88-2.84zm-9.73-12.77l-5 1.58v-4.21l5.87-2.65h4.28v20.47h-5.15V28.57zm17.61 9.96c.61-1.33.68-3.6.68-5.04s-.07-3.7-.68-5.02c-.4-.86-1.04-1.29-2-1.29-.95 0-1.59.42-1.99 1.29-.61 1.32-.68 3.58-.68 5.02 0 1.44.07 3.71.68 5.04.4.87 1.04 1.29 1.99 1.29.96 0 1.6-.42 2-1.29z"/>
        </svg>
      </div>
      <div class="center-btn" id="center-play-btn">
        <svg id="icon-play" xmlns="http://www.w3.org/2000/svg" width="67" height="67" fill="none" viewBox="0 0 67 67">
          <path fill="#fff" d="M20.28 9.65c-2.205-1.268-4.026-.228-4.026 2.307v43.805c0 2.535 1.82 3.574 4.027 2.307l38.471-21.903a2.556 2.556 0 0 0 1.094-.935 2.514 2.514 0 0 0 0-2.743 2.556 2.556 0 0 0-1.093-.936L20.28 9.65z"/>
        </svg>
        <svg id="icon-pause" xmlns="http://www.w3.org/2000/svg" width="67" height="67" fill="none" viewBox="0 0 67 67" style="display:none">
          <path fill="#fff" fill-rule="evenodd" d="M46.332 5.773a4.125 4.125 0 0 0-4.125 4.125v46.75a4.127 4.127 0 0 0 4.125 4.125 4.127 4.127 0 0 0 4.125-4.125V9.898a4.125 4.125 0 0 0-4.125-4.125zM25.707 9.898v46.75a4.125 4.125 0 1 1-8.25 0V9.898a4.123 4.123 0 0 1 4.125-4.125 4.123 4.123 0 0 1 4.125 4.125z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="center-btn skip-btn" id="skip-forward">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="none" viewBox="0 0 67 67">
          <path fill="#fff" fill-rule="evenodd" d="M33.5 0C15 0 0 15 0 33.5S15 67 33.5 67 67 52 67 33.5a2.583 2.583 0 0 0-2.58-2.53c-1.4 0-2.55 1.13-2.57 2.53 0 15.66-12.69 28.35-28.35 28.35-15.65 0-28.35-12.7-28.35-28.35 0-15.66 12.7-28.35 28.35-28.35 7.3 0 13.96 2.76 18.99 7.3.46.42.9.85 1.34 1.29h-6.59a2.58 2.58 0 0 0 0 5.16h13.75c1.42 0 2.57-1.16 2.57-2.58V2.58c0-1.43-1.15-2.58-2.57-2.58-1.43 0-2.58 1.15-2.58 2.58v8.52c-.78-.87-1.61-1.7-2.47-2.48A33.446 33.446 0 0 0 33.54 0h-.04zm.48 41.34c-1.6-2.21-2-5.2-2-7.85 0-2.65.4-5.63 2-7.83 1.44-1.97 3.47-2.84 5.88-2.84 2.41 0 4.42.87 5.86 2.84 1.61 2.21 2.03 5.16 2.03 7.83 0 2.66-.4 5.64-2 7.85-1.43 1.97-3.47 2.84-5.89 2.84-2.41 0-4.45-.87-5.88-2.84zm-9.73-12.77l-5 1.58v-4.21l5.87-2.65h4.28v20.47h-5.15V28.57zm17.61 9.96c.61-1.33.68-3.6.68-5.04s-.07-3.7-.68-5.02c-.4-.87-1.04-1.29-2-1.29-.95 0-1.59.42-1.99 1.29-.61 1.32-.68 3.58-.68 5.02 0 1.44.07 3.71.68 5.04.4.86 1.04 1.28 1.99 1.28.96 0 1.6-.42 2-1.28z"/>
        </svg>
      </div>
    </div>

    <div class="bottom-bar">
      <div class="time-display" id="time-display">0:00 / 0:00</div>
      <div class="seek-container" id="seek-container">
        <div class="seek-fill" id="seek-fill"></div>
      </div>
    </div>

    <div class="menu-popup" id="menu-subs"></div>
    <div class="menu-popup" id="menu-settings"></div>
  </div>
</div>

<script>
// ─── CONFIGURATION ─────────────────────────────────────────────────────────
const MOVIE_CONFIG = {
  tmdb_id: 411,
  // Remplacez par votre URL M3U8 :
  m3u8_url: "https://zebi.xalaflix.design/movie/411/premium-fmc6li/master.m3u8",
  external_subtitles: [],       // [{ langue: "Français", url_sub: "..." }]
  skip_intro_enabled: false,
  skip_intro_start: "00:00:00",
  skip_intro_end: "00:00:00",
  skip_credits_enabled: false,
  skip_credits_start: "00:00:00",
  redirect_url: "info?{tmdb_id}"
};

const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';

// ─── DOM ────────────────────────────────────────────────────────────────────
const body          = document.getElementById('main-body');
const video         = document.getElementById('video');
const uiLayer       = document.getElementById('ui-layer');
const clickLayer    = document.getElementById('click-layer');
const iconPlay      = document.getElementById('icon-play');
const iconPause     = document.getElementById('icon-pause');
const timeDisplay   = document.getElementById('time-display');
const seekFill      = document.getElementById('seek-fill');
const seekContainer = document.getElementById('seek-container');
const volRange      = document.getElementById('vol-range');
const volIcon       = document.getElementById('vol-icon');
const subtitleCont  = document.getElementById('subtitle-container');
const xraySidebar   = document.getElementById('xray-sidebar');
const movieTitle    = document.getElementById('movie-title');
const skipIntroBtn  = document.getElementById('skip-intro-btn');
const skipCredBtn   = document.getElementById('skip-credits-btn');
const spinner       = document.getElementById('spinner');
const errorOverlay  = document.getElementById('error-overlay');
const errorMsg      = document.getElementById('error-msg');

// ─── STATE ──────────────────────────────────────────────────────────────────
let hlsInstance = null;
let playerLoaded = false;
let isMenuOpen = false;
let xrayVisible = false;
let uiTimer = null;
let clickTimer = null;
let externalSubtracks = [];
let currentExternalSub = null;
let availableLevels = [];   // HLS quality levels
let currentAudioGroup = null;

// ─── HELPERS ────────────────────────────────────────────────────────────────
function parseTS(ts) {
  const p = ts.split(':');
  return parseInt(p[0]) * 3600 + parseInt(p[1]) * 60 + parseInt(p[2]);
}
const introStart  = parseTS(MOVIE_CONFIG.skip_intro_start);
const introEnd    = parseTS(MOVIE_CONFIG.skip_intro_end);
const credStart   = parseTS(MOVIE_CONFIG.skip_credits_start);

function formatTime(s) {
  if (isNaN(s) || s < 0) return '0:00';
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const sec = Math.floor(s % 60);
  if (h > 0) return `${h}:${m < 10 ? '0' + m : m}:${sec < 10 ? '0' + sec : sec}`;
  return `${m}:${sec < 10 ? '0' + sec : sec}`;
}

function storageKey(k) {
  return `movie_${MOVIE_CONFIG.tmdb_id}_${k}`;
}

function saveState() {
  if (!playerLoaded) return;
  localStorage.setItem(storageKey('time'), video.currentTime);
  localStorage.setItem(storageKey('vol'), video.volume);
  if (currentExternalSub) {
    localStorage.setItem(storageKey('ext_sub'), currentExternalSub.langue);
  } else {
    localStorage.removeItem(storageKey('ext_sub'));
  }
}

function loadState() {
  const t = localStorage.getItem(storageKey('time'));
  const v = localStorage.getItem(storageKey('vol'));
  if (t) video.currentTime = parseFloat(t);
  if (v) { video.volume = parseFloat(v); volRange.value = parseFloat(v); }
  updateVolumeIcon();
  const extSub = localStorage.getItem(storageKey('ext_sub'));
  if (extSub) selectExternalSub(extSub);
}

// ─── VOLUME ICONS ───────────────────────────────────────────────────────────
const volumeIcons = {
  muted:  `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" fill="none" viewBox="0 0 24 25"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20zm5-17L4 21"/></svg>`,
  low:    `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/></svg>`,
  medium: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/><path fill="#fff" d="M17.5 12a2 2 0 0 1-2 2v-4a2 2 0 0 1 2 2z"/></svg>`,
  high:   `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/><path fill="#fff" d="M17.5 12a2 2 0 0 1-2 2v-4a2 2 0 0 1 2 2z"/><path fill="#fff" fill-rule="evenodd" d="M18.536 7.08a.75.75 0 0 1 1.053.125A7.72 7.72 0 0 1 21.25 12a7.72 7.72 0 0 1-1.661 4.795.75.75 0 1 1-1.178-.929A6.22 6.22 0 0 0 19.75 12c0-1.46-.5-2.802-1.339-3.866a.75.75 0 0 1 .125-1.053z" clip-rule="evenodd"/></svg>`,
  max:    `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/><path fill="#fff" d="M17.5 12a2 2 0 0 1-2 2v-4a2 2 0 0 1 2 2z"/><path fill="#fff" fill-rule="evenodd" d="M18.536 7.08a.75.75 0 0 1 1.053.125A7.72 7.72 0 0 1 21.25 12a7.72 7.72 0 0 1-1.661 4.795.75.75 0 1 1-1.178-.929A6.22 6.22 0 0 0 19.75 12c0-1.46-.5-2.802-1.339-3.866a.75.75 0 0 1 .125-1.053z" clip-rule="evenodd"/><path fill="#fff" fill-rule="evenodd" d="M20.524 4.438a.75.75 0 0 1 1.055.103 11.705 11.705 0 0 1 2.671 7.46c0 2.83-1.002 5.43-2.67 7.458a.75.75 0 1 1-1.16-.953A10.205 10.205 0 0 0 22.75 12a10.2 10.2 0 0 0-2.33-6.506.75.75 0 0 1 .104-1.056z" clip-rule="evenodd"/></svg>`
};

function updateVolumeIcon() {
  if (video.muted || video.volume === 0) volIcon.innerHTML = volumeIcons.muted;
  else if (video.volume < 0.3)          volIcon.innerHTML = volumeIcons.low;
  else if (video.volume < 0.6)          volIcon.innerHTML = volumeIcons.medium;
  else if (video.volume < 0.9)          volIcon.innerHTML = volumeIcons.high;
  else                                   volIcon.innerHTML = volumeIcons.max;
}

// ─── SUBTITLES (external SRT) ───────────────────────────────────────────────
function parseSRT(txt) {
  const cues = [];
  const blocks = txt.trim().split(/\n\s*\n/);
  for (const block of blocks) {
    const lines = block.split('\n');
    if (lines.length < 3) continue;
    const m = lines[1].match(/(\d{2}):(\d{2}):(\d{2}),(\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2}),(\d{3})/);
    if (m) {
      cues.push({
        startTime: +m[1]*3600 + +m[2]*60 + +m[3] + +m[4]/1000,
        endTime:   +m[5]*3600 + +m[6]*60 + +m[7] + +m[8]/1000,
        text: lines.slice(2).join('\n')
      });
    }
  }
  return cues;
}

async function loadExternalSubs() {
  for (const cfg of MOVIE_CONFIG.external_subtitles) {
    try {
      const r = await fetch(cfg.url_sub);
      const txt = await r.text();
      externalSubtracks.push({ langue: cfg.langue, cues: parseSRT(txt) });
    } catch(e) { console.error('Sub load error', cfg.langue, e); }
  }
}

function selectExternalSub(langue) {
  currentExternalSub = externalSubtracks.find(t => t.langue === langue) || null;
  // disable native subtitles
  for (const t of video.textTracks) t.mode = 'hidden';
  saveState();
}

function disableExternalSubs() {
  currentExternalSub = null;
  subtitleCont.innerHTML = '';
}

function renderExternalSub(t) {
  if (!currentExternalSub) { subtitleCont.innerHTML = ''; return; }
  const cue = currentExternalSub.cues.find(c => t >= c.startTime && t <= c.endTime);
  subtitleCont.innerHTML = cue ? `<span>${cue.text}</span>` : '';
}

// ─── UI VISIBILITY ──────────────────────────────────────────────────────────
function showUI() {
  uiLayer.classList.add('visible');
  subtitleCont.classList.add('controls-visible');
  body.classList.remove('hide-cursor');
  clearTimeout(uiTimer);
  if (!video.paused && !isMenuOpen) {
    uiTimer = setTimeout(() => {
      uiLayer.classList.remove('visible');
      subtitleCont.classList.remove('controls-visible');
      body.classList.add('hide-cursor');
    }, 5000);
  }
}

clickLayer.addEventListener('mousemove', showUI);
uiLayer.addEventListener('mousemove', () => {
  clearTimeout(uiTimer);
  body.classList.remove('hide-cursor');
  uiLayer.classList.add('visible');
  subtitleCont.classList.add('controls-visible');
});

// ─── PLAY / PAUSE ───────────────────────────────────────────────────────────
function togglePlay(e) {
  if (e) e.stopPropagation();
  if (!playerLoaded) return;
  if (video.paused) {
    video.play();
    iconPlay.style.display  = 'none';
    iconPause.style.display = 'block';
    showUI();
  } else {
    video.pause();
    iconPlay.style.display  = 'block';
    iconPause.style.display = 'none';
    uiLayer.classList.add('visible');
    subtitleCont.classList.add('controls-visible');
    clearTimeout(uiTimer);
  }
}

function skip(val) {
  if (!playerLoaded) return;
  video.currentTime = Math.max(0, Math.min(video.duration || 0, video.currentTime + val));
  showUI(); saveState();
}

// Click: single = play/pause, double = fullscreen
clickLayer.addEventListener('click', () => {
  if (!playerLoaded) return;
  if (clickTimer) {
    clearTimeout(clickTimer); clickTimer = null;
    toggleFullscreen();
  } else {
    clickTimer = setTimeout(() => { clickTimer = null; togglePlay(); showUI(); }, 250);
  }
});

// ─── FULLSCREEN ─────────────────────────────────────────────────────────────
function toggleFullscreen() {
  if (!document.fullscreenElement)
    document.getElementById('player-container').requestFullscreen();
  else
    document.exitFullscreen();
}

// ─── SEEK ───────────────────────────────────────────────────────────────────
video.addEventListener('timeupdate', () => {
  if (!video.duration) return;
  seekFill.style.width = (video.currentTime / video.duration * 100) + '%';
  timeDisplay.textContent = formatTime(video.currentTime) + ' / ' + formatTime(video.duration);
  renderExternalSub(video.currentTime);
  checkSkipButtons();
  if (Math.floor(video.currentTime) % 5 === 0) saveState();
});

seekContainer.addEventListener('click', e => {
  if (!playerLoaded) return;
  e.stopPropagation();
  const r = seekContainer.getBoundingClientRect();
  video.currentTime = ((e.clientX - r.left) / r.width) * video.duration;
  saveState();
});

// ─── VOLUME ─────────────────────────────────────────────────────────────────
volRange.addEventListener('input', e => {
  video.volume = +e.target.value;
  video.muted = false;
  updateVolumeIcon(); saveState();
});

document.getElementById('vol-btn').addEventListener('click', e => {
  e.stopPropagation();
  video.muted = !video.muted;
  updateVolumeIcon(); saveState();
});

function changeVolume(delta) {
  video.volume = Math.min(1, Math.max(0, video.volume + delta));
  video.muted = false;
  volRange.value = video.volume;
  updateVolumeIcon(); saveState();
}

// ─── SKIP BUTTONS ───────────────────────────────────────────────────────────
function checkSkipButtons() {
  const t = video.currentTime;
  skipIntroBtn.style.display =
    MOVIE_CONFIG.skip_intro_enabled && t >= introStart && t < introEnd ? 'block' : 'none';
  skipCredBtn.style.display =
    MOVIE_CONFIG.skip_credits_enabled && t >= credStart ? 'block' : 'none';
}
skipIntroBtn.addEventListener('click', () => { video.currentTime = introEnd; skipIntroBtn.style.display='none'; });
skipCredBtn.addEventListener('click', () => {
  window.location.href = MOVIE_CONFIG.redirect_url.replace('{tmdb_id}', MOVIE_CONFIG.tmdb_id);
});

// ─── KEYBOARD ───────────────────────────────────────────────────────────────
window.addEventListener('keydown', e => {
  if (!playerLoaded) return;
  showUI();
  switch (e.code) {
    case 'Space':       e.preventDefault(); togglePlay(); break;
    case 'ArrowRight':  e.preventDefault(); skip(10); break;
    case 'ArrowLeft':   e.preventDefault(); skip(-10); break;
    case 'ArrowUp':     e.preventDefault(); changeVolume(0.1); break;
    case 'ArrowDown':   e.preventDefault(); changeVolume(-0.1); break;
    case 'KeyF':        toggleFullscreen(); break;
  }
});

// ─── PIP ────────────────────────────────────────────────────────────────────
document.getElementById('pip-btn').addEventListener('click', e => {
  e.stopPropagation();
  if (!playerLoaded) return;
  if (document.pictureInPictureElement) document.exitPictureInPicture();
  else video.requestPictureInPicture();
});

// ─── MENUS ──────────────────────────────────────────────────────────────────
function closeAllMenus() {
  document.querySelectorAll('.menu-popup').forEach(el => el.style.display = 'none');
  isMenuOpen = false;
}

function toggleMenu(id) {
  if (!playerLoaded) return;
  const menu = document.getElementById(id);
  const wasOpen = menu.style.display === 'flex';
  closeAllMenus();
  if (!wasOpen) { buildMenu(id); menu.style.display = 'flex'; isMenuOpen = true; clearTimeout(uiTimer); }
}

document.addEventListener('click', e => {
  if (isMenuOpen && !e.target.closest('.menu-popup') &&
      !e.target.closest('#subs-btn') && !e.target.closest('#settings-btn')) closeAllMenus();
  if (xrayVisible && !e.target.closest('#xray-sidebar') && !e.target.closest('#xray-toggle')) {
    xrayVisible = false; xraySidebar.style.display = 'none';
  }
});

function buildMenu(id) {
  const menu = document.getElementById(id);
  menu.innerHTML = '';

  if (id === 'menu-subs') {
    menu.innerHTML = '<div class="menu-header">Sous-titres & Audio</div>';

    // --- Subtitles section ---
    const secSub = document.createElement('div');
    secSub.className = 'menu-section-title'; secSub.innerText = 'Sous-titres';
    menu.appendChild(secSub);

    const offBtn = document.createElement('button');
    offBtn.innerText = 'Désactivé';
    if (!currentExternalSub && !hasActiveSub()) offBtn.className = 'active';
    offBtn.onclick = () => {
      disableExternalSubs();
      for (const t of video.textTracks) t.mode = 'hidden';
      saveState(); closeAllMenus();
    };
    menu.appendChild(offBtn);

    // Native HLS subtitles (from the manifest)
    for (const t of video.textTracks) {
      const btn = document.createElement('button');
      btn.innerText = labelForLang(t.language) || t.label || t.language;
      if (!currentExternalSub && t.mode === 'showing') btn.className = 'active';
      btn.onclick = () => {
        disableExternalSubs();
        for (const tr of video.textTracks) tr.mode = 'hidden';
        t.mode = 'showing';
        saveState(); closeAllMenus();
      };
      menu.appendChild(btn);
    }

    // External SRT subtitles
    externalSubtracks.forEach(track => {
      const btn = document.createElement('button');
      btn.innerText = track.langue;
      if (currentExternalSub && currentExternalSub.langue === track.langue) btn.className = 'active';
      btn.onclick = () => { selectExternalSub(track.langue); closeAllMenus(); };
      menu.appendChild(btn);
    });

    // --- Audio section ---
    const hr = document.createElement('div'); hr.className = 'menu-separator';
    menu.appendChild(hr);
    const secAudio = document.createElement('div');
    secAudio.className = 'menu-section-title'; secAudio.innerText = 'Audio';
    menu.appendChild(secAudio);

    if (hlsInstance) {
      const groups = [...new Set(
        (hlsInstance.levels || [])
          .filter(l => l.audioGroupIds)
          .flatMap(l => l.audioGroupIds)
      )];
      const audioTracks = hlsInstance.audioTracks || [];
      audioTracks.forEach((at, idx) => {
        const btn = document.createElement('button');
        btn.innerText = at.name || at.lang || `Audio ${idx+1}`;
        if (hlsInstance.audioTrack === idx) btn.className = 'active';
        btn.onclick = () => { hlsInstance.audioTrack = idx; saveState(); closeAllMenus(); };
        menu.appendChild(btn);
      });
      if (audioTracks.length === 0) {
        const btn = document.createElement('button');
        btn.innerText = 'Par défaut'; btn.className = 'active';
        menu.appendChild(btn);
      }
    }

  } else if (id === 'menu-settings') {
    menu.innerHTML = '<div class="menu-header">Qualité de la vidéo</div>';

    if (!hlsInstance) return;

    // Auto option
    const autoBtn = document.createElement('button');
    autoBtn.innerText = 'Auto';
    if (hlsInstance.currentLevel === -1) autoBtn.className = 'active';
    autoBtn.onclick = () => { hlsInstance.currentLevel = -1; closeAllMenus(); };
    menu.appendChild(autoBtn);

    const levels = hlsInstance.levels || [];
    const seen = new Set();
    [...levels].sort((a,b) => (b.height||0)-(a.height||0)).forEach((l, i) => {
      const h = l.height;
      if (!h || seen.has(h)) return; seen.add(h);
      const btn = document.createElement('button');
      let label = 'Bonne', sub = 'Consomme environ 0,38 Go par heure';
      if (h >= 1080) { label = 'Optimale'; sub = 'Consomme environ 1,17 Go par heure'; }
      else if (h >= 720) { label = 'Très bonne'; sub = 'Consomme environ 0,86 Go par heure'; }
      btn.innerHTML = `${label} (${h}p)<span class="menu-subtext">${sub}</span>`;
      const levelIdx = levels.indexOf(l);
      if (hlsInstance.currentLevel === levelIdx) btn.className = 'active';
      btn.onclick = () => { hlsInstance.currentLevel = levelIdx; closeAllMenus(); };
      menu.appendChild(btn);
    });
  }
}

function hasActiveSub() {
  for (const t of video.textTracks) if (t.mode === 'showing') return true;
  return false;
}

function labelForLang(lang) {
  if (!lang) return '';
  if (lang === 'fr') return 'Français';
  if (lang === 'en') return 'English';
  return lang.toUpperCase();
}

// ─── X-RAY ──────────────────────────────────────────────────────────────────
async function loadXRayData() {
  try {
    const r = await fetch(`https://api.themoviedb.org/3/movie/${MOVIE_CONFIG.tmdb_id}/credits`, {
      headers: { 'Authorization': `Bearer ${TMDB_TOKEN}` }
    });
    const d = await r.json();
    xraySidebar.innerHTML = '';
    d.cast.slice(0, 10).forEach(actor => {
      const item = document.createElement('div');
      item.className = 'actor-item';
      const photo = actor.profile_path
        ? `https://image.tmdb.org/t/p/w185${actor.profile_path}`
        : 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="120"><rect fill="%23222" width="80" height="120"/></svg>';
      item.innerHTML = `<img class="actor-photo" src="${photo}" alt="${actor.name}">
        <div class="actor-info"><div class="actor-name">${actor.name}</div>
        <div class="actor-character">${actor.character}</div></div>`;
      xraySidebar.appendChild(item);
    });
  } catch(e) { console.error('XRay error', e); }
}

document.getElementById('xray-toggle').addEventListener('click', () => {
  xrayVisible = !xrayVisible;
  xraySidebar.style.display = xrayVisible ? 'block' : 'none';
  if (xrayVisible && xraySidebar.innerHTML === '') loadXRayData();
});

// ─── TMDB TITLE ─────────────────────────────────────────────────────────────
async function loadMovieTitle() {
  try {
    const r = await fetch(
      `https://api.themoviedb.org/3/movie/${MOVIE_CONFIG.tmdb_id}?language=fr-FR`,
      { headers: { 'Authorization': `Bearer ${TMDB_TOKEN}` } }
    );
    const d = await r.json();
    movieTitle.textContent = d.title || 'Film';
  } catch(e) { movieTitle.textContent = 'Film'; }
}

// ─── HLS LOADER ─────────────────────────────────────────────────────────────
function initHLS() {
  const url = MOVIE_CONFIG.m3u8_url;
  spinner.style.display = 'block';

  if (Hls.isSupported()) {
    hlsInstance = new Hls({
      enableWorker: true,
      lowLatencyMode: false,
      backBufferLength: 90
    });

    hlsInstance.loadSource(url);
    hlsInstance.attachMedia(video);

    hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => {
      spinner.style.display = 'none';
      playerLoaded = true;
      loadState();
      video.play().catch(() => {});
      iconPlay.style.display = 'none';
      iconPause.style.display = 'block';
    });

    hlsInstance.on(Hls.Events.ERROR, (event, data) => {
      if (data.fatal) {
        spinner.style.display = 'none';
        switch (data.type) {
          case Hls.ErrorTypes.NETWORK_ERROR:
            errorMsg.textContent = 'Erreur réseau — flux inaccessible ou CORS bloqué.';
            break;
          case Hls.ErrorTypes.MEDIA_ERROR:
            errorMsg.textContent = 'Erreur média — codec non supporté.';
            hlsInstance.recoverMediaError();
            return;
          default:
            errorMsg.textContent = 'Erreur fatale de lecture HLS.';
        }
        errorOverlay.style.display = 'flex';
      }
    });

  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    // Safari native HLS
    video.src = url;
    video.addEventListener('loadedmetadata', () => {
      spinner.style.display = 'none';
      playerLoaded = true;
      loadState();
      video.play().catch(() => {});
      iconPlay.style.display = 'none';
      iconPause.style.display = 'block';
    });
    video.addEventListener('error', () => {
      spinner.style.display = 'none';
      errorMsg.textContent = 'Impossible de lire le flux sur ce navigateur.';
      errorOverlay.style.display = 'flex';
    });
  } else {
    spinner.style.display = 'none';
    errorMsg.textContent = 'Votre navigateur ne supporte pas la lecture HLS.';
    errorOverlay.style.display = 'flex';
  }
}

// ─── BUTTONS ────────────────────────────────────────────────────────────────
document.getElementById('center-play-btn').addEventListener('click', e => { e.stopPropagation(); togglePlay(); });
document.getElementById('skip-back').addEventListener('click',    e => { e.stopPropagation(); skip(-10); });
document.getElementById('skip-forward').addEventListener('click', e => { e.stopPropagation(); skip(10); });
document.getElementById('subs-btn').addEventListener('click',     e => { e.stopPropagation(); toggleMenu('menu-subs'); });
document.getElementById('settings-btn').addEventListener('click', e => { e.stopPropagation(); toggleMenu('menu-settings'); });
document.getElementById('fullscreen-btn').addEventListener('click', e => { e.stopPropagation(); toggleFullscreen(); });
window.addEventListener('contextmenu', e => e.preventDefault());

// ─── INIT ───────────────────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', async () => {
  updateVolumeIcon();
  showUI();
  await Promise.all([loadMovieTitle(), loadExternalSubs()]);
  initHLS();
});
</script>
</body>
</html>
