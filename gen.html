
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Lecteur Pro</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
            --text: #f1f5f9;
        }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .wrapper { background: var(--card); padding: 30px; border-radius: 12px; width: 100%; max-width: 800px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); }
        h1 { color: var(--accent); text-align: center; margin-bottom: 30px; }
        h2 { font-size: 1.1rem; border-left: 4px solid var(--accent); padding-left: 10px; margin-top: 25px; }
        .field { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .row { display: flex; gap: 10px; }
        .btn { background: var(--accent); color: #0f172a; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn:hover { opacity: 0.9; }
        .btn-add { width: auto; background: #22c55e; color: white; }
        .hidden { display: none; }
        #results { margin-top: 10px; max-height: 150px; overflow-y: auto; background: #0f172a; border-radius: 6px; }
        .movie-item { padding: 8px; cursor: pointer; border-bottom: 1px solid #334155; display: flex; align-items: center; gap: 10px; }
        .movie-item:hover { background: #334155; }
        .movie-item img { width: 30px; }
        .sub-badge { background: #334155; padding: 5px 10px; border-radius: 20px; display: inline-flex; align-items: center; gap: 8px; margin: 5px; font-size: 0.8rem; }
        .remove-sub { color: #ef4444; cursor: pointer; font-weight: bold; }
        .selected-info { background: #0ea5e922; border: 1px solid var(--accent); padding: 10px; border-radius: 6px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="wrapper">
    <h1>Configurateur de Lecteur</h1>

    <div class="field">
        <label><input type="checkbox" id="check-drm" style="width: auto;"> Le lien est-il chiffré (DRM ClearKey) ?</label>
    </div>

    <div class="field">
        <label>Lien du flux (MPD ou M3U8)</label>
        <input type="text" id="stream-url" placeholder="https://...">
    </div>

    <div id="drm-box" class="field hidden">
        <label>Clé DRM (Format hex_kid:hex_key)</label>
        <input type="text" id="drm-key" placeholder="a7f591...:c5bf2c...">
    </div>

    <h2>Recherche TMDB</h2>
    <div class="field">
        <div class="row">
            <input type="text" id="tmdb-search" placeholder="Nom du film...">
            <button class="btn btn-add" onclick="searchMovie()" style="padding: 0 20px;">Chercher</button>
        </div>
        <div id="results"></div>
        <div id="selected-movie" class="selected-info hidden">
            Film : <span id="m-title" style="font-weight: bold;"></span> | ID : <span id="m-id"></span>
        </div>
    </div>

    <h2>Sous-titres</h2>
    <div class="field">
        <label><input type="checkbox" id="check-subs" style="width: auto;"> Ajouter des sous-titres externes (.srt / .vtt)</label>
    </div>
    <div id="subs-box" class="hidden">
        <div class="row">
            <select id="sub-lang" style="flex: 1;">
                <option value="Français">Français</option>
                <option value="Français Audio Description">Français AD</option>
                <option value="Français Essentiel">Français Essentiel</option>
                <option value="Anglais">Anglais</option>
            </select>
            <input type="text" id="sub-url" placeholder="URL du fichier" style="flex: 2;">
            <button class="btn btn-add" onclick="addSub()">+</button>
        </div>
        <div id="sub-list" style="margin-top: 10px;"></div>
    </div>

    <h2>Génériques</h2>
    <div class="field">
        <label><input type="checkbox" id="check-intro" style="width: auto;"> Activer Skip Intro</label>
        <div id="intro-inputs" class="row hidden" style="margin-top: 5px;">
            <input type="text" id="intro-start" value="00:00:00" placeholder="Début">
            <input type="text" id="intro-end" placeholder="Fin (ex: 00:01:30)">
        </div>
    </div>
    <div class="field">
        <label><input type="checkbox" id="check-outro" style="width: auto;"> Activer Bouton Fin</label>
        <div id="outro-inputs" class="hidden" style="margin-top: 5px;">
            <input type="text" id="outro-start" placeholder="Commence à (ex: 01:55:00)">
        </div>
    </div>

    <button class="btn" onclick="buildAndDownload()">GÉNÉRER LE FICHIER HTML</button>
</div>

<script>
    const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';
    let selectedId = null;
    let subTracks = [];

    // Toggles
    document.getElementById('check-drm').onchange = e => document.getElementById('drm-box').classList.toggle('hidden', !e.target.checked);
    document.getElementById('check-subs').onchange = e => document.getElementById('subs-box').classList.toggle('hidden', !e.target.checked);
    document.getElementById('check-intro').onchange = e => document.getElementById('intro-inputs').classList.toggle('hidden', !e.target.checked);
    document.getElementById('check-outro').onchange = e => document.getElementById('outro-inputs').classList.toggle('hidden', !e.target.checked);

    async function searchMovie() {
        const query = document.getElementById('tmdb-search').value;
        const resp = await fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&language=fr-FR`, {
            headers: { Authorization: `Bearer ${TMDB_TOKEN}` }
        });
        const data = await resp.json();
        const container = document.getElementById('results');
        container.innerHTML = '';
        data.results.forEach(m => {
            const div = document.createElement('div');
            div.className = 'movie-item';
            div.innerHTML = `<img src="https://image.tmdb.org/t/p/w92${m.poster_path}"> <span>${m.title} (${m.release_date?.split('-')[0]})</span>`;
            div.onclick = () => {
                selectedId = m.id;
                document.getElementById('m-title').innerText = m.title;
                document.getElementById('m-id').innerText = m.id;
                document.getElementById('selected-movie').classList.remove('hidden');
                container.innerHTML = '';
            };
            container.appendChild(div);
        });
    }

    function addSub() {
        const lang = document.getElementById('sub-lang').value;
        const url = document.getElementById('sub-url').value;
        if (!url) return;
        subTracks.push({ langue: lang, url_sub: url });
        renderSubs();
        document.getElementById('sub-url').value = '';
    }

    function renderSubs() {
        const container = document.getElementById('sub-list');
        container.innerHTML = '';
        subTracks.forEach((s, i) => {
            container.innerHTML += `<div class="sub-badge">${s.langue} <span class="remove-sub" onclick="subTracks.splice(${i},1);renderSubs()">×</span></div>`;
        });
    }

    function buildAndDownload() {
        if (!selectedId || !document.getElementById('stream-url').value) {
            alert("Erreur : Sélectionnez un film et un lien de flux.");
            return;
        }

        const isDrm = document.getElementById('check-drm').checked;
        const drmInput = document.getElementById('drm-key').value;
        let drmObj = {};
        if (isDrm && drmInput.includes(':')) {
            const [kid, key] = drmInput.split(':');
            drmObj[kid.trim()] = key.trim();
        }

        const config = {
            tmdb_id: selectedId,
            mpd_url: document.getElementById('stream-url').value,
            drm_key: drmObj,
            external_subtitles: subTracks,
            skip_intro_enabled: document.getElementById('check-intro').checked,
            skip_intro_start: document.getElementById('intro-start').value || "00:00:00",
            skip_intro_end: document.getElementById('intro-end').value || "00:00:00",
            skip_credits_enabled: document.getElementById('check-outro').checked,
            skip_credits_start: document.getElementById('outro-start').value || "00:00:00",
            redirect_url: "info?{tmdb_id}"
        };

        const template = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Lecteur</title><script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"><\/script><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet"><style>body,html{margin:0;padding:0;background:#000;height:100%;font-family:Roboto,sans-serif;overflow:hidden;color:#fff;user-select:none}body.hide-cursor,body.hide-cursor *{cursor:none!important}#player-container{position:relative;width:100%;height:100%;background:#000;overflow:hidden}video{width:100%;height:100%;display:block;object-fit:contain}#click-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5}#ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;display:flex;flex-direction:column;justify-content:space-between;opacity:0;transition:opacity .2s ease-out;pointer-events:none}#ui-layer.visible{opacity:1}#subtitle-container{position:absolute;width:100%;bottom:100px;display:flex;justify-content:center;pointer-events:none!important;z-index:200;transition:bottom .2s ease-out}#subtitle-container.controls-visible{bottom:140px}#subtitle-container span{font-size:clamp(24px,4vw,42px);color:#fff;text-shadow:0 0 8px rgba(0,0,0,.95),0 0 12px rgba(0,0,0,.8);font-weight:500;padding:4px 12px;white-space:pre-line;text-align:center}.skip-sequence-btn{position:absolute;bottom:140px;right:40px;background:rgba(255,255,255,.95);color:#000;padding:14px 28px;border:none;border-radius:4px;font-size:16px;font-weight:700;cursor:pointer;z-index:250;transition:all .2s;display:none;pointer-events:auto}.skip-sequence-btn:hover{background:#fff;transform:scale(1.05)}#xray-sidebar{position:absolute;left:0;top:0;width:340px;height:calc(100% - 140px);background:linear-gradient(to right,rgba(0,0,0,.85) 0,transparent 100%);padding:80px 20px 20px 30px;overflow-y:auto;z-index:55;pointer-events:auto;display:none}.actor-item{display:flex;gap:12px;margin-bottom:20px;cursor:pointer;transition:transform .2s}.actor-item:hover{transform:scale(1.02)}.actor-photo{width:80px;height:120px;object-fit:cover;border-radius:4px;background:#222}.actor-name{font-size:15px;font-weight:700;color:#fff;margin-bottom:4px}.actor-character{font-size:13px;color:#aaa;font-weight:400}.top-bar{padding:25px 40px;background:linear-gradient(to bottom,rgba(0,0,0,.8) 0,transparent 100%);display:flex;justify-content:space-between;align-items:center;position:relative;z-index:100;pointer-events:auto}.top-left{display:flex;align-items:center;gap:15px;font-size:15px;color:#ccc;font-weight:500;cursor:pointer}.top-left:hover{color:#fff}.xray-text{font-weight:700;color:#fff;font-size:16px}.imdb-logo{background:#e2b616;color:#000;padding:2px 5px;border-radius:2px;font-weight:900;font-size:12px;letter-spacing:-.5px}.top-title{position:absolute;left:50%;top:30px;transform:translateX(-50%);font-size:18px;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.8);pointer-events:none;font-weight:700}.top-icons{display:flex;gap:24px;align-items:center}.icon-btn{width:25px;height:25px;color:rgba(255,255,255,.7);cursor:pointer;transition:transform .15s,color .15s;display:flex;align-items:center;justify-content:center;position:relative}.icon-btn:hover{transform:scale(1.15);color:#fff}.icon-btn svg{width:100%;height:100%}.top-icons-separator{width:1px;height:22px;background:rgba(255,255,255,.5)}.volume-container{position:relative;display:flex;flex-direction:column;align-items:center;pointer-events:auto}.vol-slider-wrapper{position:absolute;top:36px;width:40px;height:0;background:rgba(30,30,30,.95);border-radius:4px;transition:height .2s ease-out;display:flex;align-items:center;justify-content:center;z-index:200;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.6)}.volume-container:hover .vol-slider-wrapper{height:130px}.vol-slider-wrapper input[type=range]{transform:rotate(-90deg);width:100px;height:4px;background:rgba(255,255,255,.2);border-radius:2px;outline:0;-webkit-appearance:none;cursor:pointer}.center-controls{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;align-items:center;gap:80px;pointer-events:auto;z-index:60}.center-btn{cursor:pointer;transition:transform .15s;color:rgba(255,255,255,.85);display:flex;align-items:center;justify-content:center}.center-btn:hover{transform:scale(1.1);color:#fff}.bottom-bar{padding:0 40px 35px;background:linear-gradient(to top,rgba(0,0,0,.9) 0,transparent 100%);display:flex;flex-direction:column;gap:10px;pointer-events:auto;z-index:100}.time-display{font-size:14px;color:#ccc;font-weight:500;margin-left:2px}.seek-container{width:100%;height:4px;background:rgba(255,255,255,.25);cursor:pointer;position:relative;border-radius:2px;transition:height .15s}.seek-container:hover{height:6px}.seek-fill{height:100%;background:#fff;width:0%;border-radius:2px;position:relative}.seek-fill::after{content:'';position:absolute;right:-7px;top:50%;transform:translateY(-50%);width:15px;height:15px;background:#fff;border-radius:50%;opacity:0;transition:opacity .15s;box-shadow:0 1px 4px rgba(0,0,0,.5)}.seek-container:hover .seek-fill::after{opacity:1}.menu-popup{position:absolute;top:70px;right:40px;background:rgba(40,40,40,.97);backdrop-filter:blur(10px);border-radius:4px;padding:8px 0;min-width:340px;display:none;flex-direction:column;z-index:2000;box-shadow:0 8px 24px rgba(0,0,0,.6);pointer-events:auto}.menu-header{padding:12px 20px;color:#fff;font-weight:700;font-size:16px;margin-bottom:4px}.menu-section-title{padding:8px 20px;color:#aaa;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.menu-popup button{background:0 0;border:none;color:#bbb;text-align:left;padding:12px 20px 12px 50px;cursor:pointer;font-size:14px;font-weight:400;display:flex;flex-direction:column;width:100%;transition:background .15s,color .15s;position:relative}.menu-popup button:hover{background:rgba(255,255,255,.1);color:#fff}.menu-popup button.active{color:#fff;font-weight:600;background:rgba(255,255,255,.08)}.menu-popup button.active::before{content:'';position:absolute;left:20px;top:50%;transform:translateY(-50%);width:19px;height:15px;background-image:url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOSIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE5IDE1Ij48dGl0bGU+UmVjdGFuZ2xlIDUwICsgUmVjdGFuZ2xlIDUwIENvcHk8L3RpdGxlPjxnIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTIuMTIxIDZsNi4zNjQgNi4zNjQtMi4xMjEgMi4xMjJMMCA4LjEyMnoiLz48cGF0aCBkPSJNMTguNzI4IDIuMTIxTDcuMTIgMTMuNzI4IDUgMTEuNjA3IDE2LjYwNyAwbDIuMTIgMi4xMjF6Ii8+PC9nPjwvc3ZnPg==');background-size:contain;background-repeat:no-repeat}.menu-subtext{font-size:12px;color:#888;margin-top:3px;font-weight:400}.menu-separator{height:1px;background:rgba(255,255,255,.1);margin:8px 0;width:100%}#security-warning{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9999;text-align:center}</style></head>
<body id="main-body" oncontextmenu="return false;"><div id="security-warning"><h1>Lecture impossible</h1><p>Navigateur non sécurisé.</p></div><div id="player-container"><video id="video"></video><div id="subtitle-container"></div><button id="skip-intro-btn" class="skip-sequence-btn">Passer l'introduction</button><button id="skip-credits-btn" class="skip-sequence-btn">Fin du film</button><div id="click-layer"></div><div id="ui-layer"><div id="xray-sidebar"></div><div class="top-bar"><div class="top-left" id="xray-toggle"><span class="xray-text">X-Ray</span> <span class="imdb-logo">IMDb</span> <span>Tout ></span></div><div class="top-title" id="movie-title">Chargement...</div><div class="top-icons"><div class="icon-btn" id="subs-btn" title="Sous-titres & Audio"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" fill-rule="evenodd" d="M20.773 2.207h-16a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h16a4 4 0 0 0 4-4v-12a4 4 0 0 0-4-4zm-16 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-12a2 2 0 0 0-2-2h-16zm3 9a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1zm-2 3a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2zm5 1a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2h-8a1 1 0 0 1-1-1z" clip-rule="evenodd"/></svg></div><div class="volume-container"><div class="icon-btn" id="vol-btn"><svg id="vol-icon" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#fff" stroke-width="2" d="M15 20V4L8.115 7.934A.5.5 0 0 1 7.867 8H3.5a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h4.367a.5.5 0 0 1 .248.066L15 20z"/></svg></div><div class="vol-slider-wrapper"><input type="range" min="0" max="1" step="0.05" value="1" id="vol-range"></div></div><div class="icon-btn" id="settings-btn"><svg width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" d="M8.6 4.994c-.337.166-.66.353-.97.56l-1.947-.812a1.5 1.5 0 0 0-1.877.634L1.822 8.812a1.5 1.5 0 0 0 .39 1.943l1.678 1.28a8.596 8.596 0 0 0 0 1.118l-1.678 1.28a1.5 1.5 0 0 0-.39 1.943l1.984 3.436a1.5 1.5 0 0 0 1.877.634l1.947-.813c.31.207.633.395.97.56l.269 2.092a1.5 1.5 0 0 0 1.488 1.309h3.967a1.5 1.5 0 0 0 1.488-1.309l.269-2.091c.336-.166.66-.354.97-.561l1.947.813a1.5 1.5 0 0 0 1.877-.634l1.983-3.436a1.5 1.5 0 0 0-.389-1.943l-1.678-1.28a8.63 8.63 0 0 0 0-1.118l1.678-1.28a1.5 1.5 0 0 0 .39-1.943l-1.984-3.436a1.5 1.5 0 0 0-1.877-.634l-1.948.813a8.454 8.454 0 0 0-.969-.561l-.27-2.092a1.5 1.5 0 0 0-1.487-1.308h-3.967a1.5 1.5 0 0 0-1.488 1.308l-.27 2.092z"/></svg></div><div class="icon-btn" id="pip-btn"><svg width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="9" height="6" x="11" y="11.99" fill="#fff" rx="1"/><rect width="22" height="18" x="1" y="3" stroke="#fff" stroke-width="2" rx="3"/></svg></div><div class="icon-btn" id="fullscreen-btn"><svg width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" d="M4.746 8.056V6.294L18.73 20.278h-1.762a1.111 1.111 0 1 0 0 2.222h4.444a1.11 1.11 0 0 0 1.111-1.111v-4.445a1.111 1.111 0 0 0-2.222 0v1.762L6.317 4.722h1.762a1.111 1.111 0 1 0 0-2.222H3.635c-.614 0-1.112.497-1.112 1.111v4.445a1.111 1.111 0 1 0 2.223 0z"/></svg></div><div class="top-icons-separator"></div><a href="info?${config.tmdb_id}" class="icon-btn" id="close-btn"><svg width="25" height="25" fill="none" viewBox="0 0 25 25"><path fill="#fff" d="M4.691 4.667a1 1 0 0 1 1.415 0l6.418 6.419 6.42-6.42a1 1 0 1 1 1.414 1.415l-6.42 6.419 6.42 6.419a1 1 0 0 1-1.415 1.414l-6.419-6.419-6.418 6.42a1 1 0 0 1-1.415-1.415l6.42-6.419-6.42-6.419a1 1 0 0 1 0-1.414z"/></svg></a></div></div><div class="center-controls"><div class="center-btn" id="skip-back"><svg width="50" height="50" fill="none" viewBox="0 0 67 67"><path fill="#fff" d="M33.5 0C52 0 67 15 67 33.5S52 67 33.5 67 0 52 0 33.5c.03-1.4 1.17-2.53 2.58-2.53 1.4 0 2.55 1.13 2.57 2.53 0 15.65 12.7 28.35 28.35 28.35 15.66 0 28.35-12.7 28.35-28.35 0-15.66-12.69-28.35-28.35-28.35h-.04c-7 0-13.76 2.61-18.94 7.3-.46.42-.91.85-1.34 1.29h6.58c1.42 0 2.57 1.16 2.57 2.58 0 1.42-1.15 2.58-2.57 2.58H6.01c-1.42 0-2.57-1.16-2.57-2.58V2.58C3.44 1.15 4.59 0 6.01 0c1.43 0 2.58 1.15 2.58 2.58v8.52c.78-.86 1.61-1.7 2.47-2.47A33.407 33.407 0 0 1 33.46 0h.04z"/></svg></div><div class="center-btn" id="center-play-btn"><svg id="icon-play" width="67" height="67" fill="none" viewBox="0 0 67 67"><path fill="#fff" d="M20.28 9.65c-2.205-1.268-4.026-.228-4.026 2.307v43.805c0 2.535 1.82 3.574 4.027 2.307l38.471-21.903a2.556 2.556 0 0 0 1.094-.935 2.514 2.514 0 0 0 0-2.743 2.556 2.556 0 0 0-1.093-.936L20.28 9.65z"/></svg><svg id="icon-pause" width="67" height="67" fill="none" viewBox="0 0 67 67" style="display:none"><path fill="#fff" d="M46.332 5.773a4.125 4.125 0 0 0-4.125 4.125v46.75a4.127 4.127 0 0 0 4.125 4.125 4.127 4.127 0 0 0 4.125-4.125V9.898a4.125 4.125 0 0 0-4.125-4.125zM25.707 9.898v46.75a4.125 4.125 0 1 1-8.25 0V9.898a4.123 4.123 0 0 1 4.125-4.125 4.123 4.123 0 0 1 4.125 4.125z"/></svg></div><div class="center-btn" id="skip-forward"><svg width="50" height="50" fill="none" viewBox="0 0 67 67"><path fill="#fff" d="M33.5 0C15 0 0 15 0 33.5S15 67 33.5 67 67 52 67 33.5a2.583 2.583 0 0 0-2.58-2.53c-1.4 0-2.55 1.13-2.57 2.53 0 15.66-12.69 28.35-28.35 28.35-15.65 0-28.35-12.7-28.35-28.35 0-15.66 12.7-28.35 28.35-28.35 7.3 0 13.96 2.76 18.99 7.3.46.42.9.85 1.34 1.29h-6.59a2.58 2.58 0 0 0 0 5.16h13.75c1.42 0 2.57-1.16 2.57-2.58V2.58c0-1.43-1.15-2.58-2.57-2.58-1.43 0-2.58 1.15-2.58 2.58v8.52c-.78-.87-1.61-1.7-2.47-2.48A33.446 33.446 0 0 0 33.54 0h-.04z"/></svg></div></div><div class="bottom-bar"><div class="time-display" id="time-display">0:00:00 / 0:00:00</div><div class="seek-container" id="seek-container"><div class="seek-fill" id="seek-fill"></div></div></div><div class="menu-popup" id="menu-subs"></div><div class="menu-popup" id="menu-settings"></div></div></div><script>const MOVIE_CONFIG=${JSON.stringify(config,null,4)};const TMDB_TOKEN="${TMDB_TOKEN}";const video=document.getElementById("video");const subtitleContainer=document.getElementById("subtitle-container");let player,playerLoaded=!1,externalSubtitleTracks=[],currentExternalSubtitle=null;function parseTimestamp(e){const t=e.split(":");return 3600*parseInt(t[0])+60*parseInt(t[1])+parseInt(t[2])}const skipIntroStart=parseTimestamp(MOVIE_CONFIG.skip_intro_start),skipIntroEnd=parseTimestamp(MOVIE_CONFIG.skip_intro_end),skipCreditsStart=parseTimestamp(MOVIE_CONFIG.skip_credits_start);async function loadMovieTitle(){try{const e=await fetch(\`https://api.themoviedb.org/3/movie/\${MOVIE_CONFIG.tmdb_id}?language=fr-FR\`,{headers:{Authorization:\`Bearer \${TMDB_TOKEN}\`,"Content-Type":"application/json"}}),t=await e.json();document.getElementById("movie-title").textContent=t.title||"Film"}catch(e){document.getElementById("movie-title").textContent="Film"}}async function loadExternalSubtitles(){for(const e of MOVIE_CONFIG.external_subtitles)try{const t=await fetch(e.url_sub),n=await t.text();externalSubtitleTracks.push({language:e.langue,cues:parseSRT(n),url:e.url_sub})}catch(t){console.error(\`Erreur \${e.langue}\`)}}function parseSRT(e){const t=[];return e.trim().split(/\\n\\s*\\n/).forEach(e=>{const n=e.split("\\n");if(n.length>=3){const e=n[1].match(/(\\d{2}):(\\d{2}):(\\d{2}),(\\d{3})\\s*-->\\s*(\\d{2}):(\\d{2}):(\\d{2}),(\\d{3})/);if(e){const n=3600*parseInt(e[1])+60*parseInt(e[2])+parseInt(e[3])+parseInt(e[4])/1e3,o=3600*parseInt(e[5])+60*parseInt(e[6])+parseInt(e[7])+parseInt(e[8])/1e3;t.push({startTime:n,endTime:o,text:n.slice?n.slice(2).join("\\n"):""})}}}),t}function displayExternalSubtitle(e){if(!currentExternalSubtitle)return void(subtitleContainer.innerHTML="");const t=currentExternalSubtitle.cues.find(t=>e>=t.startTime&&e<=t.endTime);subtitleContainer.innerHTML=t?\`<span>\${t.text}</span>\` :""}function selectExternalSubtitle(e){const t=externalSubtitleTracks.find(t=>t.language===e);currentExternalSubtitle=t||null,player&&player.setTextTrackVisibility(!1)}async function init(){if(!window.isSecureContext)return void(document.getElementById("security-warning").style.display="flex");await Promise.all([loadExternalSubtitles(),loadMovieTitle()]),shaka.polyfill.installAll(),shaka.Player.isBrowserSupported()&&(player=new shaka.Player(video),player.configure({streaming:{alwaysStreamText:!0},textDisplayFactory:()=>new shaka.text.UITextDisplayer(video,subtitleContainer),drm:{clearKeys:MOVIE_CONFIG.drm_key},abr:{enabled:!0}}),player.load(MOVIE_CONFIG.mpd_url).then(()=>{playerLoaded=!0,document.getElementById("ui-layer").classList.add("visible")}))}document.addEventListener("DOMContentLoaded",init);video.addEventListener("timeupdate",()=>{const e=video.currentTime;currentExternalSubtitle&&displayExternalSubtitle(e),MOVIE_CONFIG.skip_intro_enabled&&e>=skipIntroStart&&e<skipIntroEnd?document.getElementById("skip-intro-btn").style.display="block":document.getElementById("skip-intro-btn").style.display="none",MOVIE_CONFIG.skip_credits_enabled&&e>=skipCreditsStart?document.getElementById("skip-credits-btn").style.display="block":document.getElementById("skip-credits-btn").style.display="none"});document.getElementById("skip-intro-btn").onclick=()=>video.currentTime=skipIntroEnd;document.getElementById("skip-credits-btn").onclick=()=>location.href=MOVIE_CONFIG.redirect_url.replace("{tmdb_id}",MOVIE_CONFIG.tmdb_id);document.getElementById("subs-btn").onclick=()=>toggleMenu("menu-subs");function toggleMenu(e){const t=document.getElementById(e);if("flex"===t.style.display)t.style.display="none";else{t.innerHTML='<div class="menu-header">Sous-titres & Audio</div>';const n=document.createElement("div");n.className="menu-section-title",n.innerText="Sous-titres",t.appendChild(n);const o=document.createElement("button");o.innerText="Désactivé",o.onclick=()=>(currentExternalSubtitle=null,t.style.display="none"),t.appendChild(o),externalSubtitleTracks.forEach(n=>{const o=document.createElement("button");o.innerText=n.language,o.onclick=()=>(selectExternalSubtitle(n.language),t.style.display="none"),t.appendChild(o)}),t.style.display="flex"}}<\/script></body></html>`;

        const blob = new Blob([template], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${selectedId}.html`; // Correction : Nom du fichier est l'ID TMDB
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>
