<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Catalogue Automatique</title>
    <style>
        :root { --bg: #0f0f0f; --card-bg: #1a1a1a; --text: #efefef; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        h1 { text-align: center; font-weight: 300; letter-spacing: 2px; margin-bottom: 40px; }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 25px; max-width: 1200px; margin: 0 auto; 
        }
        
        .movie-card { 
            background: var(--card-bg); border-radius: 12px; overflow: hidden; 
            transition: all 0.3s ease; text-decoration: none; color: inherit;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative;
        }
        
        .movie-card:hover { transform: translateY(-10px); box-shadow: 0 10px 25px rgba(0,0,0,0.8); }
        .movie-card img { width: 100%; height: 270px; object-fit: cover; border-bottom: 2px solid #333; }
        
        .info { padding: 12px; font-size: 0.85em; }
        .info strong { display: block; margin-bottom: 5px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .rating { color: #ffbd00; font-weight: bold; }
    </style>
</head>
<body>

    <h1>CINÉMA PRIVÉ</h1>
    <div class="grid" id="catalog">Chargement du catalogue...</div>

    <script>
        // --- CONFIGURATION ---
        const GITHUB_USER = 'Cyprdu'; 
        const GITHUB_REPO = 'movies-tmdb';
        const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';

        const catalogEl = document.getElementById('catalog');

        async function init() {
            try {
                // 1. Récupérer la liste des fichiers sur GitHub
                const repoUrl = `https://api.github.com/contents/`; // Racine du repo
                const resRepo = await fetch(repoUrl);
                const files = await resRepo.json();

                // 2. Filtrer pour ne garder que les fichiers .html qui sont des nombres (IDs)
                const movieIds = files
                    .filter(f => f.name.endsWith('.html') && !isNaN(f.name.split('.')[0]))
                    .map(f => f.name.split('.')[0]);

                if (movieIds.length === 0) {
                    catalogEl.innerHTML = "Aucun film trouvé.";
                    return;
                }

                catalogEl.innerHTML = ''; // Vide le message de chargement

                // 3. Boucler sur chaque ID pour chercher les infos TMDB
                for (const id of movieIds) {
                    renderMovie(id);
                }

            } catch (err) {
                console.error(err);
                catalogEl.innerHTML = "Erreur de chargement des données GitHub.";
            }
        }

        async function renderMovie(id) {
            try {
                const resTmdb = await fetch(`https://api.themoviedb.org/3/movie/${id}?language=fr-FR`, {
                    headers: { Authorization: `Bearer ${TMDB_TOKEN}` }
                });
                const movie = await resTmdb.json();

                if (movie.poster_path) {
                    const card = document.createElement('a');
                    card.href = `${id}.html`;
                    card.className = 'movie-card';
                    card.innerHTML = `
                        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
                        <div class="info">
                            <strong>${movie.title}</strong>
                            <span class="rating">★ ${movie.vote_average.toFixed(1)}</span> • ${new Date(movie.release_date).getFullYear()}
                        </div>
                    `;
                    catalogEl.appendChild(card);
                }
            } catch (e) {
                console.log(`Erreur TMDB pour l'ID ${id}`);
            }
        }

        init();
    </script>
</body>
</html>
