<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Catalogue Cyprdu</title>
    <style>
        :root { --bg: #0b0b0b; --card: #161616; --accent: #e50914; }
        body { background: var(--bg); color: white; font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 40px 20px; }
        h1 { text-align: center; color: var(--accent); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 50px; }
        
        #catalog { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 25px; max-width: 1300px; margin: 0 auto; 
        }
        
        .movie-card { 
            background: var(--card); border-radius: 8px; overflow: hidden; 
            transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); 
            text-decoration: none; color: inherit; display: block;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .movie-card:hover { transform: scale(1.08); z-index: 10; }
        .movie-card img { width: 100%; height: 270px; object-fit: cover; }
        
        .info { padding: 12px; text-align: center; }
        .title { display: block; font-weight: bold; font-size: 0.9em; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .year { color: #888; font-size: 0.8em; }

        .loader { text-align: center; font-size: 1.2em; color: #555; }
    </style>
</head>
<body>

    <h1>Mon Catalogue Cinéma</h1>
    <div id="catalog" class="loader">Analyse du dépôt GitHub...</div>

    <script>
        const API_GITHUB = 'https://api.github.com/repos/Cyprdu/movies-tmdb/contents/';
        const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0YmM5NGE4NTk4ODgzZjNhYTgyM2IxZWZmNjUzNmE5ZSIsIm5iZiI6MTc2OTAxNTQ2OS44NDgsInN1YiI6IjY5NzEwOGFkYmM1ODc1OWVkYzA4ZGE2ZCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.IyDx0X9qH6RIAPdxwODeMSZKMBgMxu07Gg6TgZZOCMw';

        async function loadCatalog() {
            const catalog = document.getElementById('catalog');
            
            try {
                // 1. Récupération des fichiers sur GitHub
                const response = await fetch(API_GITHUB);
                if (!response.ok) throw new Error("Impossible d'accéder à GitHub");
                const files = await response.json();

                // 2. Filtrage des IDs (On prend les fichiers .html qui sont des nombres)
                const ids = files
                    .filter(f => f.name.endsWith('.html') && /^\d+$/.test(f.name.split('.')[0]))
                    .map(f => f.name.split('.')[0]);

                if (ids.length === 0) {
                    catalog.innerHTML = "Aucun film détecté dans le dossier.";
                    return;
                }

                catalog.innerHTML = ''; // On efface le message de chargement

                // 3. Récupération des données TMDB pour chaque ID
                const promises = ids.map(id => fetchTMDB(id));
                await Promise.all(promises);

            } catch (error) {
                catalog.innerHTML = "⚠️ Erreur : " + error.message;
            }
        }

        async function fetchTMDB(id) {
            try {
                const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?language=fr-FR`, {
                    headers: { Authorization: `Bearer ${TMDB_TOKEN}` }
                });
                const data = await res.json();

                if (data.poster_path) {
                    const card = document.createElement('a');
                    card.href = `https://cyprdu.github.io/movies-tmdb/${id}.html`; // Lien vers votre page
                    card.className = 'movie-card';
                    card.innerHTML = `
                        <img src="https://image.tmdb.org/t/p/w500${data.poster_path}" alt="${data.title}">
                        <div class="info">
                            <span class="title">${data.title}</span>
                            <span class="year">${new Date(data.release_date).getFullYear()}</span>
                        </div>
                    `;
                    document.getElementById('catalog').appendChild(card);
                }
            } catch (e) {
                console.error("Erreur TMDB pour l'ID " + id);
            }
        }

        loadCatalog();
    </script>
</body>
</html>
